/*!
built in 2016-11-30:11 version 2.2.2 by 司徒正美
https://github.com/RubyLouvre/avalon/tree/2.2.1
添加计算属性
添加事务
内部所有类使用es6重写
修正使用requirejs加载avalon2.2.0，返回空对象的BUG
优化组件延迟定义的逻辑
fromString进行性能优化
fix 空字符串不生成节点的BUG
确保onReady的执行时机，多个ms-controller套嵌，先执行里面的，再执行外面的

*/
(function(F,Z){"object"===typeof exports&&"undefined"!==typeof module?module.exports=Z():"function"===typeof define&&define.amd?define(Z):F.avalon=Z()})(this,function(){function F(a){this.size=0;this.limit=a;this.head=this.tail=void 0;this._keymap={}}function Z(a){for(var b in sb)if("ms-"+b in a)return!0}function e(a){return new e.init(a)}function xa(a,b){for(var c in b)a[c]=b[c];return a}function z(a,b){"string"===typeof a&&(a=a.match(ya)||[]);for(var c={},d=void 0!==b?b:1,f=0,e=a.length;f<e;f++)c[a[f]]=d;return c}function Q(a){return null!==a&&"object"===typeof a}function za(a){return String(Math.random()+Math.random()).replace(Qc,a||"avalon")}function B(a){return a.uuid||(a.uuid="_"+ ++Rc)}function Aa(a){return(a+"").replace(Sc,"\\$\x26")}function t(a){for(var b in a){var c=a[b];if("function"===typeof t.plugins[b])t.plugins[b](c);else t[b]=c}return this}function R(a){return/\[native code\]/.test(a)}function aa(a,b,c){a="for(var "+a+"i\x3d0,n \x3d this.length; i \x3c n; i++){"+b.replace("_","((i in this) \x26\x26 fn.call(scope,this[i],i,this))")+"}"+c;return Function("fn,scope",a)}function Tc(a){return a?a==a.document&&a.document!=a:!1}function tb(a){return Uc.test(S.call(a))}function Vc(a,b){if(!a||"object"!==e.type(a)||a.nodeType||e.isWindow(a))return!1;try{if(a.constructor&&!K.call(a,"constructor")&&!K.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(ub)for(b in a)return K.call(a,b);for(b in a);return void 0===b||K.call(a,b)}function Wc(a){return"[object Object]"===S.call(a)&&Object.getPrototypeOf(a)===Object.prototype}function Xc(a){if(!a)return!1;var b=a.length;if(b===b>>>0){b=S.call(a).slice(8,-1);if(Yc.test(b)||"Array"===b)return!0;try{return!1==={}.propertyIsEnumerable.call(a,"length")?vb.test(a.item||a.callee):!0}catch(c){return!a.window}}return!1}function Zc(a,b){var c=Math.pow(10,b);return""+(Math.round(a*c)/c).toFixed(b)}function wb(a,b,c,d){a=(a+"").replace(/[^0-9+\-Ee.]/g,"");a=isFinite(+a)?+a:0;b=isFinite(+b)?Math.abs(b):3;d=d||",";c=c||".";a=(b?Zc(a,b):""+Math.round(a)).split(".");3<a[0].length&&(a[0]=a[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,d));return a.join(c)}function C(a){return parseInt(a,10)||0}function Ba(a,b,c){var d="";0>a&&(d="-",a=-a);for(a=""+a;a.length<b;)a="0"+a;c&&(a=a.substr(a.length-b));return d+a}function u(a,b,c,d){return function(f){f=f["get"+a]();if(0<c||f>-c)f+=c;0===f&&-12===c&&(f=12);return Ba(f,b,d)}}function ga(a,b){return function(c,d){var f=c["get"+a](),e=(b?"SHORT"+a:a).toUpperCase();return d[e][f]}}function Ca(a,b){var c=Ca.locate,d="",f=[],e,h;b=b||"mediumDate";b=c[b]||b;if("string"===typeof a)if(/^\d+$/.test(a))a=C(a);else if($c.test(a))a=+RegExp.$1;else{h=a.trim();var k=[0,0,0,0,0,0,0],l=new Date(0);h=h.replace(/^(\d+)\D(\d+)\D(\d+)/,function(a,b,c,d){a=4===d.length?[d,b,c]:[b,c,d];k[0]=C(a[0]);k[1]=C(a[1])-1;k[2]=C(a[2]);return""});var r=l.setFullYear,T=l.setHours;h=h.replace(/[T\s](\d+):(\d+):?(\d+)?\.?(\d)?/,function(a,b,c,d,f){k[3]=C(b);k[4]=C(c);k[5]=C(d);f&&(k[6]=Math.round(1E3*parseFloat("0."+f)));return""});var q=0,m=0;h=h.replace(/Z|([+-])(\d\d):?(\d\d)/,function(a,b,c,d){r=l.setUTCFullYear;T=l.setUTCHours;b&&(q=C(b+c),m=C(b+d));return""});k[3]-=q;k[4]-=m;r.apply(l,k.slice(0,3));T.apply(l,k.slice(3));a=l}for("number"===typeof a&&(a=new Date(a));b;)(h=ad.exec(b))?(f=f.concat(h.slice(1)),b=f.pop()):(f.push(b),b=null);f.forEach(function(b){e=bd[b];d+=e?e(a,c):b.replace(/(^'|'$)/g,"").replace(/''/g,"'")});return d}function ha(a,b,c){for(var d=0,f=b.length;d<f;d++)c(b[d]);return a}function xb(a){var b=[],c=0,d;for(d in a)a.hasOwnProperty(d)&&(b[c]={oldIndex:c,value:a[d],key:d},c++);return b}function yb(a){return null==a?"":String(a).replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;").replace(/"/g,"\x26quot;").replace(/'/g,"\x26#39;")}function zb(a){return"undefined"!==typeof a.getElementsByTagName?a.getElementsByTagName("*"):"undefined"!==typeof a.querySelectorAll?a.querySelectorAll("*"):[]}function cd(a){var b=a.cloneNode(!0),c=zb(b);a=zb(a);for(var d=0;d<a.length;d++){var f=c[d],g=a[d];if(1===f.nodeType){var h=f.nodeName.toLowerCase();if("script"===h)f.text!==g.text&&(f.type="noexec",f.text=g.text,f.type=g.type||"");else if("object"===h){if(g=g.childNodes,f.childNodes.length!==g.length){e.clearHTML(f);for(var h=0,k;k=g[h++];)f.appendChild(k.cloneNode(!0))}}else if("input"===h&&Da.test(g.nodeName))f.defaultChecked=f.checked=g.checked,f.value!==g.value&&(f.value=g.value);else if("option"===h)f.defaultSelected=f.selected=g.defaultSelected;else if("input"===h||"textarea"===h)f.defaultValue=g.defaultValue}}return b}function Ea(a,b){try{for(;b=b.parentNode;)if(b===a)return!0}catch(c){}return!1}function dd(){10>x&&(e.cloneNode=cd);m.contains||(m.contains=function(a){return Ea(m,a)});v.Node&&!m.createTextNode("x").contains&&(Node.prototype.contains=function(a){return Ea(this,a)});v.HTMLElement&&!e.root.outerHTML&&HTMLElement.prototype.__defineGetter__("outerHTML",function(){var a=m.createElement("div");a.appendChild(this);return a.innerHTML})}function Ab(a){this.node=a}function Bb(a){"classList"in a||(a.classList=new Ab(a));return a.classList}function ed(a){if("string"===typeof a){if((a=a.trim())&&fd.test(a.replace(gd,"@").replace(hd,"]").replace(id,"")))return(new Function("return "+a))();throw TypeError("Invalid JSON: ["+a+"]");}return a}function Cb(a,b){if(0>=a.offsetWidth){if(jd.test(p["@:get"](a,"display"))){var c={node:a},d;for(d in Db)c[d]=a.style[d],a.style[d]=Db[d];b.push(c)}(c=a.parentNode)&&1===c.nodeType&&Cb(c,b)}}function kd(a){if(a.hasAttribute&&a.hasAttribute("value"))return a.getAttribute("value");var b=a.getAttributeNode("value");return b&&b.specified?b.value:a.innerHTML.trim()}function U(a){var b="??"+ld++;ia.map[b]=a;return b+" "}function L(a){return ia.map[a]}function Eb(a){for(var b=a,c,d=0,f=[],e=0,h=b.length;e<h;e++){var k=b.charAt(e);c?k===c&&(f.push(b.slice(d,e+1)),c=!1):"'"===k?(c="'",d=e):'"'===k&&(c='"',d=e)}b=0;for(c=f.length;b<c;b++)a=a.replace(f[b],U);return a}function Fb(a,b,c){switch(b){case "style":case "script":case "noscript":case "template":case "xmp":a.children=[{nodeName:"#text",nodeValue:c}];break;case "textarea":var d=a.props;d.type=b;d.value=c;a.children=[{nodeName:"#text",nodeValue:c}];break;case "option":a.children=[{nodeName:"#text",nodeValue:String(c).replace(md,"").trim()}]}}function nd(a){for(var b,c=!1,d=0,f=0,e=a.length,h=0;h<e;h++){var k=a[h];b?"tr"!==k.nodeName&&k.children?b=!1:(b.children.push(k),d++,a[h]=0):"tr"===(k.type||k.nodeName)&&(b={nodeName:"tbody",props:{},children:[]},b.children.push(k),c=!0,0===f&&(f=h),a[h]=b)}if(c)for(h=f;h<e&&(0!==a[h]||(a.splice(h,1),h--,d--,0!==d));h++);}function ba(a){var b=a,c=Gb.get(b);if(c)return e.mix(!0,[],c);ia.map={};a=Eb(a);var d=[];d.last=function(){return d[d.length-1]};var c=[],f=1E5;do{var g=!1;if("\x3c"!==a.charAt(0)){var h=a.indexOf("\x3c");if(-1===h)h=a.length;else if(!Hb.test(a.charAt(h+1))){for(g=a.length-h;g--&&!Hb.test(a.charAt(h+1));)h=a.indexOf("\x3c",h+1);0==g&&(h=a.length)}var k=a.slice(0,h).replace(M,L);a=a.slice(h);g={nodeName:"#text",nodeValue:k};od.test(k)&&Fa(g,d,c)}g||(h=a.indexOf("\x3c!--"),0===h&&(g=a.indexOf("--\x3e"),-1===g&&e.error("\u6ce8\u91ca\u8282\u70b9\u6ca1\u6709\u95ed\u5408"+a),k=a.slice(4,g).replace(M,L),a=a.slice(g+3),g={nodeName:"#comment",nodeValue:k},Fa(g,d,c)));if(!g&&(k=a.match(pd))){h=k[1];/^[A-Z]/.test(h);var h=h.toLowerCase(),l=!!Ib[h]||"/"===k[3],g={nodeName:h,props:{},children:[],isVoidTag:l},r=k[2];r&&qd(r,g.props);Fa(g,d,c);a=a.slice(k[0].length);if(l)g.end=!0;else if(d.push(g),Ga[h]||"option"==h)k=a.indexOf("\x3c/"+h+"\x3e"),l=a.slice(0,k).trim(),a=a.slice(k),Fb(g,h,e.unescapeHTML(l.replace(M,L)))}!g&&(k=a.match(rd))&&(h=k[1].toLowerCase(),g=d.last(),g?g.nodeName!==h&&(g=ast.nodeName+"\u6ca1\u6709\u95ed\u5408,\u8bf7\u6ce8\u610f\u5c5e\u6027\u7684\u5f15\u53f7",e.warn(g),e.error(g)):e.error(k[0]+"\u524d\u9762\u7f3a\u5c11\x3c"+h+"\x3e"),g=d.pop(),g.end=!0,a=a.slice(k[0].length));if(!g||0===--f)break;g.end&&("table"===g.nodeName&&nd(g.children),delete g.end)}while(a.length);Gb.put(b,e.mix(!0,[],c));return c}function Fa(a,b,c){if(b=b.last()){c=b.nodeName;var d=a.nodeName,f=sd[c];f&&("p"===c?Ha[d]&&e.warn("P element can not  add these childlren:\n"+Object.keys(Ha)):f[d]||e.warn(c.toUpperCase()+"element only add these children:\n"+Object.keys(f)+"\nbut you add "+d.toUpperCase()+" !!"));b.children.push(a)}else c.push(a)}function qd(a,b){for(;a;){var c=td.exec(a);if(c){var d=c[1],f=c[2]||"";a=a.replace(c[0],"");f&&0===f.indexOf("??")&&(f=e.unescapeHTML(f.replace(M,L)).replace(ud,"").slice(1,-1));d in b||(b[d]=f)}else break}}function Ia(a,b){a.setAttribute("avalon-events",b)}function Jb(a,b,c){var d=a.getAttribute("avalon-events");if(d&&(!0!==a.disabled||"click"!==b)){var f=[],g=Kb[b]||(Kb[b]=new RegExp("\\b"+b+"\\:([^,\\s]+)","g"));d.replace(g,function(a,b){f.push(b);return a});f.length&&c.push({elem:a,uuids:f})}a=a.parentNode;d=e.gestureEvents||{};a&&a.getAttribute&&(ja[b]||d[b])&&Jb(a,b,c)}function Ja(a){a=new Ka(a);var b=a.type,c=a.target,d=[];Jb(c,b,d);for(var f=0,g,h,k;(k=d[f++])&&!a.cancelBubble;)for(a.currentTarget=k.elem,g=0;(h=k.uuids[g++])&&!a.stopImmediate;){var l=e.eventListeners[h];if(l){if((h=vd.test(h)?k.elem._ms_context_:0)&&!1===h.$hashcode)return e.unbind(c,b,l);!1===l.call(h||c,a)&&(a.preventDefault(),a.stopPropagation())}}}function Ka(a){if(a.originalEvent)return a;for(var b in a)Lb[b]||(this[b]=a[b]);this.target||(this.target=a.srcElement);this.fixEvent();this.timeStamp=new Date-0;this.originalEvent=a}function V(a){for(e.isReady=!0;a=Mb.shift();)a(e)}function wd(){function a(){try{G.doScroll("left"),V()}catch(c){setTimeout(a)}}if("complete"===m.readyState)setTimeout(V);else if(m.addEventListener)m.addEventListener("DOMContentLoaded",V,!1);else if(m.attachEvent){m.attachEvent("onreadystatechange",function(){"complete"===m.readyState&&V()});try{var b=null===v.frameElement}catch(c){}G.doScroll&&b&&v.external&&a()}e.bind(v,"load",V)}function Nb(a){var b=a.nodeName.toLowerCase();switch(b){case "#text":case "#comment":return{nodeName:b,dom:a,nodeValue:a.nodeValue};default:for(var c=!!Ib[b],d=a.attributes||[],f={},e=0,h=d.length;e<h;e++){var k=d[e];k.specified&&(f[k.name.toLowerCase()]=k.value)}xd.test(a.nodeName)&&(f.type=a.type,(d=a.getAttributeNode("value"))&&/\S/.test(d.value)&&(f.value=d.value));if(d=a.style.cssText)f.style=d;"select-one"===f.type&&(f.selectedIndex=a.selectedIndex);c={nodeName:b,dom:a,isVoidTag:c,props:f};if(Ga[b]||"option"==b)Fb(c,b,a.text||a.innerHTML),1===a.childNodes.length&&(c.children[0].dom=a.firstChild);else if(!c.isVoidTag)for(c.children=[],b=0;f=a.childNodes[b++];)f=Nb(f),/\S/.test(f.nodeValue)&&c.children.push(f);return c}}function La(a){this.nodeName="#text";this.nodeValue=a}function Ma(a){this.nodeName="#comment";this.nodeValue=a}function Na(a,b,c,d){this.nodeName=a;this.props=b;this.children=c;this.isVoidTag=d}function yd(a){31>m.styleSheets.length?m.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)"):m.styleSheets[0].addRule(".rvml","behavior:url(#default#VML)");var b=a.split(":");1===b.length&&b.unshift("v");a=b[1];b=b[0];m.namespaces[b]||m.namespaces.add(b,"urn:schemas-microsoft-com:vml");return m.createElement("\x3c"+b+":"+a+' class\x3d"rvml"\x3e')}function ka(a,b,c,d){this.nodeName="#document-fragment";this.children=a||[];this.key=b;this.val=c;this.index=d;this.props={}}function la(a){1===e.inBatch&&(e.observerQueue.forEach(function(a){a.isAddToQueue=!1}),e.observerQueue=[]);e.inBatch--}function Ob(){if(!(!0===e.isRunningActions||0<e.inTransaction)){e.isRunningActions=!0;for(var a=e.pendingActions.splice(0,e.pendingActions.length),b=0,c;c=a[b++];)c.update();e.isRunningActions=!1}}function Pb(a,b){var c=e.trackingAction;c&&Qb.push(c);e.trackingAction=a;e.track("\u3010action\u3011",a.type,a.expr,"\u5f00\u59cb\u5f81\u6536\u4f9d\u8d56\u9879");a.mapIDs={};var d=!0,f;try{f=b.call(a),d=!1}finally{if(d)e.warn("collectDeps fail",b+""),a.mapIDs={},e.trackingAction=c;else{e.trackingAction=Qb.pop();try{var g=a.observers,d=[],c={},h;for(h in a.mapIDs){var k=a.mapIDs[h];k.isAction||(d.push(k),k.isCollected=!1,c[k.uuid]=1,e.Array.ensure(k.observers,a))}if(a.isComputed){a.depsCount=d.length;a.deps=e.mix({},a.mapIDs);a.depsVersion={};for(var l in a.mapIDs){var r=a.mapIDs[l];a.depsVersion[r.uuid]=r.version}}else a.observers=d;h=0;for(var T;T=g[h++];)c[T.uuid]||e.Array.remove(T.observers,a)}catch(q){e.warn(q)}}return f}}function Rb(a){0===--e.inTransaction&&(e.isRunningActions=!1,Ob());la(a)}function zd(a){return a.replace(Ad,U).replace(Bd,function(a){return Cd[a]?a:"__vmodel__."+a})}function W(a,b){var c=a+":"+b,d=Sb.get(c);if(d)return d.slice(0);ia.map={};var d=a.replace(Dd,U),d=Eb(d),d=d.replace(Ed,U).replace(Fd,"$1").replace(Gd,"$1__vmodel__.").replace(Hd,function(a,b,c){return b+U(c)+":"}).replace(Id,function(a,b){return"|"+U(b)}),d=zd(d),d=d.split(Jd),f=d.shift().replace(M,L).trim();/\?\?\d/.test(f)&&(f=f.replace(M,L));d.length?(d=d.map(function(a){var b="";a=a.replace(Kd,function(a,c){/\S/.test(c)&&(b+=","+c);return""});return"["+e.quote(a.trim())+b+"]"}),d=("avalon.composeFilters("+d+")(__value__)").replace(M,L)):d="";return Sb.put(c,[f,d])}function Oa(a){Ld.test(a)&&(a+="($event)");9>x&&(a=a.replace(Md,function(a,c,d){return"__vmodel__."+c+".call(__vmodel__"+(/\S/.test(d)?","+d:"")+")"}));return a}function Pa(a,b,c){for(var d in b)1!==Nd[d]&&(this[d]=b[d]);this.vm=a;this.observers=[];this.callback=c;this.uuid=++Od;this.mapIDs={};this.isAction=!0;a=this.expr;if("function"!==typeof this.getter){var f;b=W(a,this.type);b=b[1]?b[1].replace(/__value__\)$/,b[0]+")"):b[0];try{f=new Function("__vmodel__","return "+b+";")}catch(h){e.log("parse getter: [",a,b,"]error"),f=e.noop}this.getter=f}if("duplex"===this.type){var g;f="try{ "+W(a,this.type)[0]+" \x3d __value__}catch(e){}";try{g=new Function("__vmodel__","__value__",f+";")}catch(h){e.log("parse setter: ",a," error"),g=e.noop}this.setter=g}this.oldValue=null;this.node||(this.value=this.get())}function ma(a,b,c){this.expr=a;if(b){var d=n.createProxy(b,this);d&&(b=d)}this.value=b;this.vm=c;try{c.$mutations[a]=this}catch(f){}this.uuid=++Pd;this.updateVersion();this.mapIDs={};this.observers=[]}function Qd(a){a=a.toString();return a.substring(a.indexOf("{}")+1,a.lastIndexOf("}"))}function Rd(a){var b=function(){};b.prototype=a;return new b}function Sd(a,b){"function"===typeof b&&((a.prototype=Rd(b.prototype)).constructor=a)}function Qa(a,b){e.mix(this,a);e.mix(this,D);this.$hashcode=e.makeHashCode("$");this.$id=this.$id||this.$hashcode;this.$events={__dep__:b||new ma(this.$id)};e.config.inProxyMode?(delete this.$mutations,this.$accessors={},this.$computed={},this.$track=""):this.$accessors={$model:Tb};void 0===b?(this.$watch=n.watchFactory(this.$events),this.$fire=n.fireFactory(this.$events)):(delete this.$watch,delete this.$fire)}function Td(a,b,c){return a in D?!1:"$"===a.charAt(0)?c?(Ub[a]||(Ub[a]=1,e.warn("ms-for\u4e2d\u7684\u53d8\u91cf\u4e0d\u518d\u5efa\u8bae\u4ee5$\u4e3a\u524d\u7f00")),!0):!1:null==b?(e.warn("\u5b9a\u4e49vmodel\u65f6\u5c5e\u6027\u503c\u4e0d\u80fd\u4e3anull undefine"),!0):/error|date|function|regexp/.test(e.type(b))?!1:!(b&&b.nodeName&&b.nodeType)}function Ra(a,b,c){var d=null,f=c?Ud:ma;return{get:function(){d||(d=new f(a,b,this));return d.get()},set:function(c){d||(d=new f(a,b,this));d.set(c)},enumerable:!0,configurable:!0}}function na(a){var b=e.type(a);if("array"===b){for(var b=[],c=0;c<a.length;c++)b[c]=na(a[c]);return b}if("object"===b&&"string"===typeof a.$track){var d={};(a.$track.match(/[^\u2625]+/g)||[]).forEach(function(b){var c=a[b];d[b]=c&&c.$events?na(c):c});return d}return a}function Vb(a,b,c){Sa?Object.defineProperty(a,b,{value:c,writable:!0,enumerable:!1,configurable:!0}):Vd[b]||(a[b]=c)}function Wb(a){var b=[],c;for(c in a)b.push(c);return b}function Ta(a,b,c){if(0===c)return a===b;if(null===a&&null===b||void 0===a&&void 0===b)return!0;var d=Array.isArray(a);if(d!==Array.isArray(b))return!1;if(d){if(a.length!==b.length)return!1;for(d=a.length-1;0<=d;d--)try{if(!Ta(a[d],b[d],c-1))return!1}catch(g){return!1}return!0}if("object"===typeof a&&"object"===typeof b){if(null===a||null===b||Wb(a).length!==Wb(b).length)return!1;for(var f in a){if(!(f in b))return!1;try{if(!Ta(a[f],b[f],c-1))return!1}catch(g){return!1}}return!0}return a===b}function Xb(){var a=Ua[0];a&&a()}function Yb(a,b,c){a=[].concat(a[b]);b=0;for(var d;d=a[b++];)"function"===typeof d&&d(c)}function Va(a){var b=a.toLowerCase();return function(c){var d=this.dom,f=e(d),g=isFinite(c.stagger)?1E3*c.stagger:0;if(g&&c.staggerKey){var h=Zb.get(c.staggerKey)||Zb.put(c.staggerKey,{count:0,items:0});h.count++;h.items++}var k=h&&h.count||0,l,r=function(b){b=!1!==b;0===--d.__ms_effect_&&(e.unbind(d,Wa),e.unbind(d,Xa));clearTimeout(l);Yb(c,"on"+a+(b?"Done":"Abort"),d);h&&0===--h.items&&(h.count=0);c.queue&&(Ua.shift(),Xb())};Yb(c,"onBefore"+a,d);if(c[b])c[b](d,function(a){r(!1!==a)});else oa&&(f.addClass(c[b+"Class"]),f.removeClass(Wd(c,b)),d.__ms_effect_?d.__ms_effect_++:(f.bind(Wa,r),f.bind(Xa,r),d.__ms_effect_=1),setTimeout(function(){var a=!1;f.addClass(c[b+"ActiveClass"]);a=Xd(d);g||(l=setTimeout(function(){r(!1)},a+32))},17+g*k))}}function Wd(a,b){b="leave"===b?"enter":"leave";return[b+"Class",b+"ActiveClass"].map(function(b){return a[b]}).join(" ")}function $b(a){var b=Yd.test(a)?1E3:1;return parseFloat(a)*b}function Xd(a){a=v.getComputedStyle(a,null);var b=a[Zd];return $b(a[$d])||$b(b)}function ca(a,b){var c=a.ownerDocument,d=a.nodeName,f="_"+d;ca[f]||(d=c.body.appendChild(c.createElement(d)),b=e.css(d,"display"),c.body.removeChild(d),"none"===b&&(b="block"),ca[f]=b);return ca[f]}function ac(a,b){var c=a.innerRender=e.scan(a.fragment,a.vm);e.shadowCopy(b,c.root);delete b.nodeValue}function ae(a,b){if(Q(b)){var c=Array.isArray(b),d=[],f=[],g=0;e.each(b,function(a,b){var e;c?(e=typeof b,e=b&&"object"===e?b.$hashcode:e+":"+b):e=a;f.push(new ka([],e,b,g++));d.push(e)});a.isArray=c;a.fragments&&(a.preFragments=a.fragments);a.fragments=f;return d.join(";;")}return NaN}function be(a){var b=a.fragments.map(function(b,c){bc(b,a,c);Ya(a.cache,b);return b}),c=a.parentChildren,d=c.indexOf(a.begin);c.splice.apply(c,[d+1,0].concat(b))}function ce(a){var b=a.cache,c={},d=[],f=a.preFragments;f.forEach(function(a){a._dispose=!0});a.fragments.forEach(function(f,e){var g=cc(b,f.key);g?(delete g._dispose,g.oldIndex=g.index,g.index=e,g.vm[a.keyName]=a.isArray?e:g.key,Ya(c,g)):d.push(f)});d.forEach(function(d){var e;for(var g in b){e=g;break}e=e?cc(b,e):void 0;e?(e.oldIndex=e.index,e.key=d.key,g=e.val=d.val,d=e.index=d.index,e.vm[a.valName]=g,e.vm[a.keyName]=a.isArray?d:e.key,delete e._dispose):(e=bc(d,a,d.index),f.push(e));Ya(c,e)});a.fragments=f;f.sort(function(a,b){return a.index-b.index});a.cache=c}function bc(a,b,c){var d={};d[b.keyName]=b.isArray?c:a.key;d[b.valName]=a.val;b.asName&&(d[b.asName]=b.value);var f=a.vm=n.itemFactory(b.vm,{data:d});b.isArray?f.$watch(b.valName,function(a){b.value&&b.value.set&&b.value.set(f[b.keyName],a)}):f.$watch(b.valName,function(c){b.value[a.key]=c});a.index=c;a.innerRender=e.scan(b.fragment,f,function(){N.push.apply(a.children,this.root.children);this.root=a});return a}function cc(a,b){var c=a[b];if(c){var d=c.arr;if(d){var f=d.pop();d.length||(c.arr=0);return f}delete a[b];return c}}function Ya(a,b){var c=b.key;a[c]?(c=a[c],(c.arr||(c.arr=[])).push(b)):a[c]=b}function dc(){for(var a=[],b=0;b<arguments.length;b++){var c=arguments[b],d=typeof c;if("string"===d||"number"===d||!0===c)a.push(c);else if(Array.isArray(c))a.push(dc.apply(null,c));else if("object"===d)for(var f in c)c.hasOwnProperty(f)&&c[f]&&a.push(f)}return a.join(" ")}function pa(a){var b=a.target;e(b).addClass(b.getAttribute(ec[a.type])||"")}function da(a){var b=a.target;a=ec[a.type];e(b).removeClass(b.getAttribute(a)||"");"change-active"!==a&&e(b).removeClass(b.getAttribute("change-active")||"")}function fc(a,b){a.children&&a.children.forEach(function(a){if("option"===a.nodeName){var c=a.props;if(!("disabled"in c)){var f=gc(a,c).trim();c.selected=-1!==b.indexOf(f);a.dom&&(a.dom.selected=c.selected)}}else fc(a,b)})}function gc(a,b){if(b&&"value"in b)return b.value;var c=[];a.children.forEach(function(a){"#text"===a.nodeName?c.push(a.nodeValue):"#document-fragment"===a.nodeName&&c.push(gc(a))});return c.join("")}function de(a){for(var b=0,c;c=this.parsers[b++];)(c=e.parsers[c])&&(a=c.call(this,a));return a}function qa(a){a.userCb&&a.userCb.call(a.vm,{type:"changed",target:a.dom})}function w(a){var b=this._ms_duplex_;if(!this.composing&&this.value!==b.value){if(this.caret)try{var c=b.getCaret(this);b.pos=c}catch(d){}4<b.debounceTime?(a=new Date,c=a-b.time||0,b.time=a,c>=b.debounceTime?ea[b.dtype].call(b):(clearTimeout(b.debounceID),b.debounceID=setTimeout(function(){ea[b.dtype].call(b)},c))):ea[b.dtype].call(b)}}function hc(a){"value"===a.propertyName&&w.call(this,a)}function H(a){var b=this;setTimeout(function(){w.call(b,a)},0)}function ic(){this.caret=!0}function jc(){this.caret=!1}function Za(){this.composing=!0}function $a(a){this.composing=!1;H.call(this,a)}function ra(a){var b=a.keyCode;91===b||15<b&&19>b||37<=b&&40>=b||w.call(this,a)}function ee(a,b){var c;a.createTextRange?setTimeout(function(){a.focus();c=a.createTextRange();c.collapse(!0);c.moveEnd("character",b);c.moveStart("character",b);c.select()},0):(a.focus(),void 0!==a.selectionStart&&a.setSelectionRange(b,b))}function fe(a){var b=0,c,d,f;"number"==typeof a.selectionStart&&"number"==typeof a.selectionEnd?b=a.selectionStart:(d=m.selection.createRange())&&d.parentElement()==a&&(f=a.value.length,c=a.value.replace(/\r\n/g,"\n"),b=a.createTextRange(),b.moveToBookmark(d.getBookmark()),a=a.createTextRange(),a.collapse(!1),-1<b.compareEndPoints("StartToEnd",a)?b=f:(b=-b.moveStart("character",-f),b+=c.slice(0,b).split("\n").length-1));return b}function kc(a,b){var c=this.dom;if(this.isString&&b&&!a&&!c.valueHijack){c.valueHijack=w;var d=setInterval(function(){e.contains(e.root,c)?c.valueHijack({type:"poll"}):clearInterval(d)},30);return d}}function ge(){var a=this.data||{};return this.message.replace(he,function(b,c){return null==a[c]?"":a[c]})}function ie(a,b,c,d){var f=b.type,g=e.directives[f];if(A){var h=e.vdom(c,"toDOM");1===h.nodeType&&h.removeAttribute(b.attrName);c.dom=h}var h=g.update?function(a){!d.mount&&/css|visible|duplex/.test(f)?d.callbacks.push(function(){g.update.call(l,l.node,a)}):g.update.call(l,l.node,a)}:e.noop,k;for(k in g)b[k]=g[k];b.node=c;var l=new Pa(a,b,h);l.init&&l.init();l.update();return l}function je(a,b){return a.priority-b.priority}function ab(a,b){b&&b.forEach(function(b){if(b){if("#document-fragment"===b.nodeName)var c=m.createDocumentFragment();else c=e.vdom(b,"toDOM"),c.childNodes&&b.children&&c.childNodes.length>b.children.length&&e.clearHTML(c);b.children&&b.children.length&&ab(c,b.children);try{var f=a.nodeName.toLowerCase();ke[f]||a.appendChild(c)}catch(g){}}})}function bb(a){for(var b;b=a.firstChild;)1===b.nodeType&&bb(b),a.removeChild(b)}function lc(a,b){var c=a.indexOf(b)+1,d=1,f=[],e;for(f.start=c;b=a[c++];)if(f.push(b),"#comment"===b.nodeName)if(0===b.nodeValue.indexOf("ms-for:"))d++;else if("ms-for-end:"===b.nodeValue&&(d--,0===d)){e=b;f.pop();break}f.end=e;return f}function mc(a,b,c){this.root=a;this.vm=b;this.beforeReady=c;this.bindings=[];this.callbacks=[];this.directives=[];this.init()}function le(a){a=n.toJson(a);if(Array.isArray(a)){var b={};a.forEach(function(a){a&&e.shadowCopy(b,a)});return b}return a}function nc(a,b){a.innerRender=b;var c=b.root,d=a.node,f=d.props.slot,e;for(e in c)d[e]=c[e];d.props&&f&&(d.props.slot=f);b.root=d;b.vnodes[0]=d}function X(a,b,c){var d=a.$events["on"+c];d&&d.forEach(function(d){d.callback.call(a,{type:c.toLowerCase(),target:b.dom,vmodel:a})})}function me(a,b,c){var d=[];a=a.defaults;oc(a,d);oc(b,d);var f={},g;for(g in a){var h=b[g];f[g]=null==h?a[g]:h}f.$id=b.id||b.$id||e.makeHashCode(c);delete f.id;b=e.mix(!0,{},f);var k=e.define(b);d.forEach(function(a){k.$watch(a.type,a.cb)});return k}function oc(a,b){for(var c in a)ne[c]&&"function"===typeof a[c]&&0===c.indexOf("on")&&b.unshift({type:c,cb:a[c]})}function pc(a,b){var c=b&&b[0]&&b[0].forDir;c&&(c.parentChildren=a)}function qc(a,b){for(var c=0,d;d=a[c];c++)if("slot"===d.nodeName){pc(a,b);a.splice.apply(a,[c,1].concat(b));break}else d.children&&qc(d.children,b)}function rc(a,b){for(var c=0,d;d=a[c];c++)"slot"===d.nodeName?(d=d.props.name,pc(a,b[d]),a.splice.apply(a,[c,1].concat(b[d]))):d.children&&rc(d.children,b)}var sa="object"===typeof window?window:"object"===typeof global?global:{},A=!!sa.location&&sa.navigator,m=A?sa.document:{createElement:Object,createElementNS:Object,documentElement:"xx",contains:Boolean},G=A?m.documentElement:{outerHTML:"x"},oe={objectobject:7,objectundefined:6,undefinedfunction:NaN,undefinedobject:NaN},x=m.documentMode||oe[typeof m.all+typeof XMLHttpRequest],E=/NaN/.test(x)||8<x;F.prototype={put:function(a,b){var c={key:a,value:b};this._keymap[a]=c;this.tail?(this.tail.newer=c,c.older=this.tail):this.head=c;this.tail=c;this.size===this.limit?this.shift():this.size++;return b},shift:function(){var a=this.head;a&&(this.head=this.head.newer,this.head.older=a.newer=a.older=this._keymap[a.key]=void 0,delete this._keymap[a.key],this.size--)},get:function(a){a=this._keymap[a];if(void 0!==a){if(a===this.tail)return a.value;a.newer&&(a===this.head&&(this.head=a.newer),a.newer.older=a.older);a.older&&(a.older.newer=a.newer);a.newer=void 0;if(a.older=this.tail)this.tail.newer=a;this.tail=a;return a.value}}};var sb={},y={},v=sa;e.init=function(a){this[0]=this.element=a};e.fn=e.prototype=e.init.prototype;var ya=/[^, ]+/g,cb=/\S+/g,n={},sc=Object.prototype,S=sc.toString,K=sc.hasOwnProperty,N=Array.prototype,tc="object"===typeof console;e.config={debug:!0};var pe=/([a-z\d])([A-Z]+)/g,qe=/[-_][^-_]/g,ta=N.slice,Qc=/\d\.\d{4}/,Rc=1,Sc=/[-.*+?^${}()|[\]\/\\]/g,O={},p={};v.avalon=e;var re=/&[a-z0-9#]{2,10};/,db=m.createElement("div");xa(e,{Array:{merge:function(a,b){a.push.apply(a,b)},ensure:function(a,b){if(-1===a.indexOf(b))return a.push(b)},removeAt:function(a,b){return!!a.splice(b,1).length},remove:function(a,b){var c=a.indexOf(b);return~c?e.Array.removeAt(a,c):!1}},evaluatorPool:new F(888),parsers:{number:function(a){return""===a?"":parseFloat(a)||0},string:function(a){return null===a||void 0===a?"":a+""},"boolean":function(a){return""===a?a:"true"===a||"1"===a}},_decode:function(a){return re.test(a)?(db.innerHTML=a,db.innerText||db.textContent):a}});t.plugins={interpolate:function(a){var b=a[0];a=a[1];if(b===a)throw new SyntaxError("interpolate openTag cannot equal to closeTag");if(/[<>]/.test(b+"test"+a))throw new SyntaxError('interpolate cannot contains "\x3c" or "\x3e"');t.openTag=b;t.closeTag=a;b=Aa(b);a=Aa(a);t.rtext=new RegExp(b+"(.+?)"+a,"g");t.rexpr=new RegExp(b+"([\\s\\S]*)"+a)}};t({interpolate:["{{","}}"],debug:!0});xa(e,{shadowCopy:xa,oneObject:z,inspect:S,ohasOwn:K,rword:ya,version:"2.2.2",vmodels:{},directives:y,directive:function(a,b){y[a]&&e.warn(a,"directive have defined! ");y[a]=b;b.update||(b.update=function(){});b.delay&&(sb[a]=1);return b},eventHooks:O,eventListeners:{},validators:{},cssHooks:p,log:function(){tc&&e.config.debug&&Function.apply.call(console.log,console,arguments)},noop:function(){},warn:function(){tc&&e.config.debug&&Function.apply.call(console.warn||console.log,console,arguments)},error:function(a,b){throw(a||Error)(b);},config:t,modern:E,msie:x,root:G,document:m,window:v,inBrowser:A,isObject:Q,range:function(a,b,c){c||(c=1);null==b&&(b=a||0,a=0);var d=-1;b=Math.max(0,Math.ceil((b-a)/c));for(var f=Array(b);++d<b;)f[d]=a,a+=c;return f},slice:function(a,b,c){return ta.call(a,b,c)},hyphen:function(a){return a.replace(pe,"$1-$2").toLowerCase()},camelize:function(a){return!a||0>a.indexOf("-")&&0>a.indexOf("_")?a:a.replace(qe,function(a){return a.charAt(1).toUpperCase()})},escapeRegExp:Aa,quote:function(a){return e._quote(a)},makeHashCode:za});if(!R("\u53f8\u5f92\u6b63\u7f8e".trim)){var se=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(se,"")}}var te=!{toString:null}.propertyIsEnumerable("toString"),ue=function(){}.propertyIsEnumerable("prototype"),uc="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),ve=uc.length;R(Object.keys)||(Object.keys=function(a){var b=[],c=ue&&"function"===typeof a;if("string"===typeof a||a&&a.callee)for(c=0;c<a.length;++c)b.push(String(c));else for(var d in a)c&&"prototype"===d||!K.call(a,d)||b.push(String(d));if(te)for(c=(c=a.constructor)&&c.prototype===a,d=0;d<ve;d++){var f=uc[d];c&&"constructor"===f||!K.call(a,f)||b.push(f)}return b});R(Array.isArray)||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});R(R.bind)||(Function.prototype.bind=function(a){if(2>arguments.length&&void 0===a)return this;var b=this,c=arguments;return function(){var d=[],f;for(f=1;f<c.length;f++)d.push(c[f]);for(f=0;f<arguments.length;f++)d.push(arguments[f]);return b.apply(a,d)}});try{ta.call(e.document.documentElement)}catch(a){N.slice=function(a,c){c="undefined"!==typeof c?c:this.length;if(Array.isArray(this))return ta.call(this,a,c);var b,f=[],e;b=this.length;var h=a||0,h=0<=h?h:b+h;e=c?c:b;0>c&&(e=b+c);e-=h;if(0<e)if(f=Array(e),this.charAt)for(b=0;b<e;b++)f[b]=this.charAt(h+b);else for(b=0;b<e;b++)f[b]=this[h+b];return f}}R(N.map)||e.shadowCopy(N,{indexOf:function(a,b){var c=this.length,d=~~b;for(0>d&&(d+=c);d<c;d++)if(this[d]===a)return d;return-1},lastIndexOf:function(a,b){var c=this.length,d=null==b?c-1:b;for(0>d&&(d=Math.max(0,c+d));0<=d;d--)if(this[d]===a)return d;return-1},forEach:aa("","_",""),filter:aa("r\x3d[],j\x3d0,","if(_)r[j++]\x3dthis[i]","return r"),map:aa("r\x3d[],","r[i]\x3d_","return r"),some:aa("","if(_)return true","return false"),every:aa("","if(!_)return false","return true")});var we=function(){var a={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},b=function(b){b=b.charCodeAt(0);var c=a[b];return c?c:"\\u00"+("000000"+(b.toString(16)||0)).slice(-2)},c=/[\x00-\x1f\x22\x5c]/g;return function(a){c.lastIndex=0;return'"'+(c.test(a)?String(a).replace(c,b):a)+'"'}}();try{e._quote=JSON.stringify}catch(a){e._quote=we}var vc={};"Boolean Number String Function Array Date RegExp Object Error".replace(e.rword,function(a){vc["[object "+a+"]"]=a.toLowerCase()});e.type=function(a){return null==a?String(a):"object"===typeof a||"function"===typeof a?vc[S.call(a)]||"object":typeof a};var vb=/^\s*\bfunction\b/;e.isFunction="object"===typeof alert?function(a){try{return vb.test(a+"")}catch(b){return!1}}:function(a){return"[object Function]"===S.call(a)};var Uc=/^\[object (?:Window|DOMWindow|global)\]$/;e.isWindow=tb(e.window)?tb:Tc;var wc,ub;for(wc in e({}))break;ub="0"!==wc;e.isPlainObject=/\[native code\]/.test(Object.getPrototypeOf)?Wc:Vc;e.mix=e.fn.mix=function(){var a,b,c,d,f,g,h=arguments[0]||{},k=1,l=arguments.length,r=!1;"boolean"===typeof h&&(r=h,h=arguments[1]||{},k++);"object"===typeof h||e.isFunction(h)||(h={});k===l&&(h=this,k--);for(;k<l;k++)if(null!=(a=arguments[k])){var m=Array.isArray(a);for(b in a)if(!m||a.hasOwnProperty(b)){try{c=h[b],d=a[b]}catch(q){continue}h!==d&&(r&&d&&(e.isPlainObject(d)||(f=Array.isArray(d)))?(f?(f=!1,g=c&&Array.isArray(c)?c:[]):g=c&&e.isPlainObject(c)?c:{},h[b]=e.mix(r,g,d)):void 0!==d&&(h[b]=d))}}return h};var Yc=/(Array|List|Collection|Map|Arguments)\]$/;e.each=function(a,b){if(a){var c=0;if(Xc(a))for(var d=a.length;c<d&&!1!==b(c,a[c]);c++);else for(c in a)if(a.hasOwnProperty(c)&&!1===b(c,a[c]))break}};new function(){var a=["%cavalon.js %c"+e.version+" %cin debug mode, %cmore...","color: rgb(114, 157, 52); font-weight: normal;","color: rgb(85, 85, 85); font-weight: normal;","color: rgb(85, 85, 85); font-weight: normal;","color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;"];if("object"===typeof console){var b=console,c=b.groupCollapsed||b.log;Function.apply.call(c,b,a);b.log("You're running avalon in debug mode - messages will be printed to the console to help you fix problems and optimise your application.\n\nTo disable debug mode, add this line at the start of your app:\n\n  avalon.config({debug: false});\n\nDebug mode also automatically shut down amicably when your app is minified.\n\nGet help and support:\n  https://segmentfault.com/t/avalon\n  http://avalonjs.coding.me/\n  http://www.baidu-x.com/?q\x3davalonjs\n  http://www.avalon.org.cn/\n\nFound a bug? Raise an issue:\n  https://github.com/RubyLouvre/avalon/issues\n\n");c!==console.log&&b.groupEnd(a)}};var xe=/<script[^>]*>([\S\s]*?)<\/script\s*>/gim,ye=/\s+(on[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,ze=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/ig,Ae={a:/\b(href)\=("javascript[^"]*"|'javascript[^']*')/ig,img:/\b(src)\=("javascript[^"]*"|'javascript[^']*')/ig,form:/\b(action)\=("javascript[^"]*"|'javascript[^']*')/ig},bd={yyyy:u("FullYear",4),yy:u("FullYear",2,0,!0),y:u("FullYear",1),MMMM:ga("Month"),MMM:ga("Month",!0),MM:u("Month",2,1),M:u("Month",1,1),dd:u("Date",2),d:u("Date",1),HH:u("Hours",2),H:u("Hours",1),hh:u("Hours",2,-12),h:u("Hours",1,-12),mm:u("Minutes",2),m:u("Minutes",1),ss:u("Seconds",2),s:u("Seconds",1),sss:u("Milliseconds",3),EEEE:ga("Day"),EEE:ga("Day",!0),a:function(a,b){return 12>a.getHours()?b.AMPMS[0]:b.AMPMS[1]},Z:function(a){a=-1*a.getTimezoneOffset();return(0<=a?"+":"")+(Ba(Math[0<a?"floor":"ceil"](a/60),2)+Ba(Math.abs(a%60),2))}},ad=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,$c=/^\/Date\((\d+)\)\/$/,eb={AMPMS:{0:"\u4e0a\u5348",1:"\u4e0b\u5348"},DAY:{0:"\u661f\u671f\u65e5",1:"\u661f\u671f\u4e00",2:"\u661f\u671f\u4e8c",3:"\u661f\u671f\u4e09",4:"\u661f\u671f\u56db",5:"\u661f\u671f\u4e94",6:"\u661f\u671f\u516d"},MONTH:{0:"1\u6708",1:"2\u6708",2:"3\u6708",3:"4\u6708",4:"5\u6708",5:"6\u6708",6:"7\u6708",7:"8\u6708",8:"9\u6708",9:"10\u6708",10:"11\u6708",11:"12\u6708"},SHORTDAY:{0:"\u5468\u65e5",1:"\u5468\u4e00",2:"\u5468\u4e8c",3:"\u5468\u4e09",4:"\u5468\u56db",5:"\u5468\u4e94",6:"\u5468\u516d"},fullDate:"y\u5e74M\u6708d\u65e5EEEE",longDate:"y\u5e74M\u6708d\u65e5",medium:"yyyy-M-d H:mm:ss",mediumDate:"yyyy-M-d",mediumTime:"H:mm:ss","short":"yy-M-d ah:mm",shortDate:"yy-M-d",shortTime:"ah:mm"};eb.SHORTMONTH=eb.MONTH;Ca.locate=eb;var xc={stop:function(a){a.stopPropagation();return a},prevent:function(a){a.preventDefault();return a}},yc={esc:27,tab:9,enter:13,space:32,del:46,up:38,left:37,right:39,down:40},fb;for(fb in yc)(function(a,b){xc[a]=function(a){a.which!==b&&(a.$return=!0);return a}})(fb,yc[fb]);var Be=e.filters={};e.composeFilters=function(){var a=arguments;return function(b){for(var c=0,d;d=a[c++];){var f=e.filters[d[0]];if("function"===typeof f){d[0]=b;try{b=f.apply(0,d)}catch(g){}}}return b}};e.escapeHtml=yb;e.mix(Be,{uppercase:function(a){return String(a).toUpperCase()},lowercase:function(a){return String(a).toLowerCase()},truncate:function(a,b,c){if(!a)return"";a=String(a);isNaN(b)&&(b=30);c="string"===typeof c?c:"...";return a.length>b?a.slice(0,b-c.length)+c:a},camelize:e.camelize,date:Ca,escape:yb,sanitize:function(a){return a.replace(xe,"").replace(ze,function(a,c){var b=a.toLowerCase().match(/<(\w+)\s/);b&&(b=Ae[b[1]])&&(a=a.replace(b,function(a,b,c){a=c.charAt(0);return b+"\x3d"+a+"javascript:void(0)"+a}));return a.replace(ye," ").replace(/\s+/g," ")})},number:wb,currency:function(a,b,c){return(b||"\u00a5")+wb(a,isFinite(c)?c:2)}},{filterBy:function(a,b){var c=e.type(a);if("array"!==c&&"object"!==c)throw"filterBy\u53ea\u80fd\u5904\u7406\u5bf9\u8c61\u6216\u6570\u7ec4";var d=e.slice(arguments,2),f=e.type(b);if("function"===f)var g=b;else if("string"===f||"number"===f){if(""===b)return a;var h=new RegExp(e.escapeRegExp(b),"i"),g=function(a){return h.test(a)}}else return a;a=xb(a).filter(function(a,b){return!!g.apply(a,[a.value,b].concat(d))});var k="array"===c,l=k?[]:{};return ha(l,a,function(a){k?l.push(a.value):l[a.key]=a.value})},orderBy:function(a,b,c){var d=e.type(a);if("array"!==d&&"object"!==d)throw"orderBy\u53ea\u80fd\u5904\u7406\u5bf9\u8c61\u6216\u6570\u7ec4";var f="string"==typeof b?function(a){return a&&a[b]}:"function"===typeof b?b:function(a){return a},g={},h=[],k;for(k in a)if(a.hasOwnProperty(k)){var l=f(a[k],k);l in g?g[l].push(k):g[l]=[k];h.push(l)}h.sort();0>c&&h.reverse();var r="array"===d,m=r?[]:{};return ha(m,h,function(b){b=g[b].shift();r?m.push(a[b]):m[b]=a[b]})},selectBy:function(a,b,c){if(e.isObject(a)&&!Array.isArray(a)){var d=[];return ha(d,b,function(b){d.push(a.hasOwnProperty(b)?a[b]:c?c[b]:"")})}return a},limitBy:function(a,b,c){var d=e.type(a);if("array"!==d&&"object"!==d)throw"limitBy\u53ea\u80fd\u5904\u7406\u5bf9\u8c61\u6216\u6570\u7ec4";if("number"!==typeof b||b!==b)return a;"object"===d&&(a=xb(a));var f=a.length;b=Math.floor(Math.min(f,b));c="number"===typeof c?c:0;0>c&&(c=Math.max(0,f+c));for(var g=[];c<f&&g.length!==b;c++)g.push(a[c]);if("array"===d)return g;var h={};return ha(h,g,function(a){h[a.key]=a.value})}},xc);var Da=/^(?:checkbox|radio)$/;e.contains=Ea;e.cloneNode=function(a){return a.cloneNode(!0)};A&&dd();Ab.prototype={toString:function(){var a=this.node.className;return(a=("string"===typeof a?a:a.baseVal).match(cb))?a.join(" "):""},contains:function(a){return-1<(" "+this+" ").indexOf(" "+a+" ")},add:function(a){this.contains(a)||this.set(this+" "+a)},remove:function(a){this.set((" "+this+" ").replace(" "+a+" "," "))},set:function(a){a=a.trim();var b=this.node;"object"===typeof b.className?b.setAttribute("class",a):b.className=a}};"add,remove".replace(ya,function(a){e.fn[a+"Class"]=function(b){var c=this[0]||{};b&&"string"===typeof b&&1===c.nodeType&&b.replace(cb,function(b){Bb(c)[a](b)});return this}});e.shadowCopy(e.fn,{hasClass:function(a){var b=this[0]||{};return 1===b.nodeType&&Bb(b).contains(a)},toggleClass:function(a,b){var c="boolean"===typeof b,d=this;String(a).replace(cb,function(a){var e=c?b:!d.hasClass(a);d[e?"addClass":"removeClass"](a)});return this}});var gb={"accept-charset":"acceptCharset","char":"ch",charoff:"chOff","class":"className","for":"htmlFor","http-equiv":"httpEquiv"};"autofocus,autoplay,async,allowTransparency,checked,controls,declare,disabled,defer,defaultChecked,defaultSelected,,isMap,loop,multiple,noHref,noResize,noShade,open,readOnly,selected".replace(/\w+/g,function(a){gb[a.toLowerCase()]=a});"accessKey,bgColor,cellPadding,cellSpacing,codeBase,codeType,colSpan,dateTime,defaultValue,contentEditable,frameBorder,longDesc,maxLength,marginWidth,marginHeight,rowSpan,tabIndex,useMap,vSpace,valueType,vAlign".replace(/\w+/g,function(a){gb[a.toLowerCase()]=a});var fd=/^[\],:{}\s]*$/,id=/(?:^|:|,)(?:\s*\[)+/g,gd=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,hd=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,Ce=/^\[object SVG\w*Element\]$/,De=/&amp;/g,hb={};try{e.parseJSON=JSON.parse}catch(a){e.parseJSON=ed}e.fn.attr=function(a,b){return 2===arguments.length?(this[0].setAttribute(a,b),this):this[0].getAttribute(a)};var ua={"float":"cssFloat"};e.cssNumber=z("animationIterationCount,columnCount,order,flex,flexGrow,flexShrink,fillOpacity,fontWeight,lineHeight,opacity,orphans,widows,zIndex,zoom");var zc=["","-webkit-","-o-","-moz-","-ms-"];e.cssName=function(a,b,c){if(ua[a])return ua[a];b=b||e.root.style||{};for(var d=0,f=zc.length;d<f;d++)if(c=e.camelize(zc[d]+a),c in b)return ua[a]=c;return null};e.css=function(a,b,c,d){a instanceof e&&(a=a[0]);if(1===a.nodeType){d=e.camelize(b);b=e.cssName(d)||d;if(void 0===c||"boolean"===typeof c)return d=p[d+":get"]||p["@:get"],"background"===b&&(b="backgroundColor"),a=d(a,b),!0===c?parseFloat(a)||0:a;""===c?a.style[b]="":null!=c&&c===c&&(isFinite(c)&&!e.cssNumber[d]&&(c+="px"),d=p[d+":set"]||p["@:set"],d(a,b,c))}};e.fn.css=function(a,b){if(e.isPlainObject(a))for(var c in a)e.css(this,c,a[c]);else var d=e.css(this,a,b);return void 0!==d?d:this};e.fn.position=function(){var a,b,c=this[0],d={top:0,left:0};if(!c)return d;"fixed"===this.css("position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),"HTML"!==a[0].tagName&&(d=a.offset()),d.top+=e.css(a[0],"borderTopWidth",!0),d.left+=e.css(a[0],"borderLeftWidth",!0),d.top-=a.scrollTop(),d.left-=a.scrollLeft());return{top:b.top-d.top-e.css(c,"marginTop",!0),left:b.left-d.left-e.css(c,"marginLeft",!0)}};e.fn.offsetParent=function(){for(var a=this[0].offsetParent;a&&"static"===e.css(a,"position");)a=a.offsetParent;return e(a||e.root)};p["@:set"]=function(a,b,c){try{a.style[b]=c}catch(d){}};p["@:get"]=function(a,b){if(!a||!a.style)throw Error("getComputedStyle\u8981\u6c42\u4f20\u5165\u4e00\u4e2a\u8282\u70b9 "+a);var c,d=v.getComputedStyle(a,null);d&&(c="filter"===b?d.getPropertyValue(b):d[b],""===c&&(c=a.style[b]));return c};p["opacity:get"]=function(a){a=p["@:get"](a,"opacity");return""===a?"1":a};"top,left".replace(e.rword,function(a){p[a+":get"]=function(b){var c=p["@:get"](b,a);return/px$/.test(c)?c:e(b).position()[a]+"px"}});var Db={position:"absolute",visibility:"hidden",display:"block"},jd=/^(none|table(?!-c[ea]).+)/;e.each({Width:"width",Height:"height"},function(a,b){var c="client"+a,d="scroll"+a,f="offset"+a;p[b+":get"]=function(b,c,d){var g=-4;"number"===typeof d&&(g=d);c="Width"===a?["Left","Right"]:["Top","Bottom"];d=b[f];if(2===g)return d+e.css(b,"margin"+c[0],!0)+e.css(b,"margin"+c[1],!0);0>g&&(d=d-e.css(b,"border"+c[0]+"Width",!0)-e.css(b,"border"+c[1]+"Width",!0));-4===g&&(d=d-e.css(b,"padding"+c[0],!0)-e.css(b,"padding"+c[1],!0));return d};p[b+"\x26get"]=function(a){var c=[];Cb(a,c);for(var d=p[b+":get"](a),e=0,f;f=c[e++];){a=f.node;for(var g in f)"string"===typeof f[g]&&(a.style[g]=f[g])}return d};e.fn[b]=function(e){var g=this[0];if(0===arguments.length){if(g.setTimeout)return g["inner"+a]||g.document.documentElement[c]||g.document.body[c];if(9===g.nodeType){var k=g.documentElement;return Math.max(g.body[d],k[d],g.body[f],k[f],k[c])}return p[b+"\x26get"](g)}return this.css(b,e)};e.fn["inner"+a]=function(){return p[b+":get"](this[0],void 0,-2)};e.fn["outer"+a]=function(a){return p[b+":get"](this[0],void 0,!0===a?2:0)}});if(9>x){ua["float"]="styleFloat";var Ee=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,Fe=/^(top|right|bottom|left)$/,Ac=/alpha\([^)]+\)/i,Ge=/(opacity|\d(\d|\.)*)/g,ib=8===x,He={thin:ib?"1px":"2px",medium:ib?"3px":"4px",thick:ib?"5px":"6px"};p["@:get"]=function(a,b){var c=a.currentStyle,d=c[b];if(Ee.test(d)&&!Fe.test(d)){var e=a.style,g=e.left,h=a.runtimeStyle.left;a.runtimeStyle.left=c.left;d=e.pixelLeft+"px";e.left=g;a.runtimeStyle.left=h}"medium"===d&&(b=b.replace("Width","Style"),"none"===c[b]&&(d="0px"));return""===d?"auto":He[d]||d};p["opacity:set"]=function(a,b,c){a=a.style;c=1>=Number(c)?"alpha(opacity\x3d"+100*c+")":"";b=a.filter||"";a.zoom=1;a.filter=(Ac.test(b)?b.replace(Ac,c):b+" "+c).trim();a.filter||a.removeAttribute("filter")};p["opacity:get"]=function(a){a=a.style.filter.match(Ge)||[];for(var b=!1,c=0,d;d=a[c++];)if("opacity"===d)b=!0;else if(b)return d/100+"";return"1"}}e.fn.offset=function(){var a=this[0],b={left:0,top:0};if(!a||!a.tagName||!a.ownerDocument)return b;var c=a.ownerDocument,d=c.body,f=c.documentElement,c=c.defaultView||c.parentWindow;if(!e.contains(f,a))return b;a.getBoundingClientRect&&(b=a.getBoundingClientRect());return{top:b.top+Math.max(c.pageYOffset||0,f.scrollTop,d.scrollTop)-(f.clientTop||d.clientTop),left:b.left+Math.max(c.pageXOffset||0,f.scrollLeft,d.scrollLeft)-(f.clientLeft||d.clientLeft)}};e.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){e.fn[a]=function(c){var d=this[0]||{},f=d.window||d.defaultView||d.parentWindow||!1,g=e.root,h="scrollTop"===a;if(arguments.length)f?f.scrollTo(h?e(f).scrollLeft():c,h?c:e(f).scrollTop()):d[a]=c;else return f?b in f?f[b]:g[a]:d[a]}});var jb={"option:get":x?kd:function(a){return a.value},"select:get":function(a,b){for(var c,d=a.options,e=a.selectedIndex,g=jb["option:get"],h="select-one"===a.type||0>e,k=h?null:[],l=h?e+1:d.length,m=0>e?l:h?e:0;m<l;m++)if(c=d[m],!(!c.selected&&m!==e||c.disabled||c.parentNode.disabled&&"OPTGROUP"===c.parentNode.tagName)){b=g(c);if(h)return b;k.push(b)}return k},"select:set":function(a,b,c){b=[].concat(b);for(var d=jb["option:get"],e=0,g;g=a.options[e++];)if(g.selected=-1<b.indexOf(d(g)))c=!0;c||(a.selectedIndex=-1)}};e.fn.val=function(a){var b=this[0];if(b&&1===b.nodeType){var c=0===arguments.length,d=c?":get":":set",e=jb,g;g=b.tagName.toLowerCase();g="input"===g?Da.test(b.type)?"checked":b.type:g;if(d=e[g+d])var h=d(b,a);else{if(c)return(b.value||"").replace(/\r/g,"");b.value=a}}return c?h:this};var ld=0,ia={map:{}},M=/\?\?\d+/g,Ib={area:1,base:1,basefont:1,bgsound:1,br:1,col:1,command:1,embed:1,frame:1,hr:1,img:1,input:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1},Ga={script:1,style:1,textarea:1,xmp:1,noscript:1,template:1},md=/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,Ha=z("div,ul,ol,dl,table,h1,h2,h3,h4,h5,h6,form,fieldset"),kb=z("tr,style,script,template,#document-fragment"),sd={p:Ha,select:z("option,optgroup,#text,#document-fragment"),optgroup:z("option,#text,#document-fragment"),option:z("#text,#document-fragment"),tr:z("th,td,style,script,template,#document-fragment"),tbody:kb,tfoot:kb,thead:kb,colgroup:z("col,template,#document-fragment"),head:z("base,basefont,bgsound,link,style,script,meta,title,noscript,noframes,template,#document-fragment"),html:z("head,body")},pd=/^<([-A-Za-z0-9_]+)\s*([^>]*?)(\/?)>/,rd=/^<\/([^>]+)>/,od=/\S/;e.lexer=function(a){return ba(a)};var Hb=/[\!\/a-z]/i,Gb=new F(100),ud=/[\n\r]s*/g,td=/([^=\s]+)(?:\s*=\s*(\S+))?/,Ie=/<|&#?\w+;/,Bc=new F(128),Je=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig;e.parseHTML=function(a){var b=m.createDocumentFragment();if("string"!==typeof a)return b;if(!Ie.test(a))return m.createTextNode(a);a=a.replace(Je,"\x3c$1\x3e\x3c/$2\x3e").trim();var c=Bc.get(a);if(c)return e.cloneNode(c);for(var c=ba(a),d=0,f;f=c[d++];)f=e.vdom(f,"toDOM"),b.appendChild(f);1024>a.length&&Bc.put(a,b);return b};e.innerHTML=function(a,b){var c=e.parseHTML(b);this.clearHTML(a);a.appendChild(c)};e.unescapeHTML=function(a){return String(a).replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"\x3c").replace(/&gt;/g,"\x3e").replace(/&amp;/g,"\x26")};e.clearHTML=function(a){for(;a.lastChild;)a.removeChild(a.lastChild);return a};var ja={click:!0,dblclick:!0,keydown:!0,keypress:!0,keyup:!0,mousedown:!0,mousemove:!0,mouseup:!0,mouseover:!0,mouseout:!0,wheel:!0,mousewheel:!0,input:!0,change:!0,beforeinput:!0,compositionstart:!0,compositionupdate:!0,compositionend:!0,select:!0,cut:!0,copy:!0,paste:!0,beforecut:!0,beforecopy:!0,beforepaste:!0,focusin:!0,focusout:!0,DOMFocusIn:!0,DOMFocusOut:!0,DOMActivate:!0,dragend:!0,datasetchanged:!0},Ke=e.modern&&m.ontouchstart;e.fn.bind=function(a,b,c){if(this[0])return e.bind(this[0],a,b,c)};e.fn.unbind=function(a,b,c){if(this[0]){var d=ta.call(arguments);d.unshift(this[0]);e.unbind.apply(0,d)}return this};e.bind=function(a,b,c){if(1===a.nodeType){var d=a.getAttribute("avalon-events")||"",f=B(c),g=O[b];"click"===b&&Ke&&a.addEventListener("click",e.noop);g&&(b=g.type||b,g.fix&&(c=g.fix(a,c),c.uuid=f));f=b+":"+f;e.eventListeners[c.uuid]=c;-1===d.indexOf(b+":")&&(ja[b]||e.modern&&Cc[b]?(g=G.getAttribute("delegate-events")||"",-1===g.indexOf(b)&&(g=g.match(e.rword)||[],g.push(b),G.setAttribute("delegate-events",g.join(",")),e._nativeBind(G,b,Ja,!!Cc[b]))):e._nativeBind(a,b,Ja));d=d.split(",");""===d[0]&&d.shift();-1===d.indexOf(f)&&(d.push(f),Ia(a,d.join(",")))}else e._nativeBind(a,b,c);return c};e.unbind=function(a,b,c){if(1===a.nodeType){var d=a.getAttribute("avalon-events")||"";switch(arguments.length){case 1:e._nativeUnBind(a,b,Ja);a.removeAttribute("avalon-events");break;case 2:d=d.split(",").filter(function(a){return-1===a.indexOf(b+":")}).join(",");Ia(a,d);break;default:var f=b+":"+c.uuid,d=d.split(",").filter(function(a){return a!==f}).join(",");Ia(a,d);delete e.eventListeners[c.uuid]}}else e._nativeUnBind(a,b,c)};var Kb={},vd=/^e/,Cc={focus:!0,blur:!0},Lb={webkitMovementY:1,webkitMovementX:1,fixEvent:function(){},preventDefault:function(){var a=this.originalEvent||{};a.returnValue=this.returnValue=!1;E&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent||{};a.cancelBubble=this.cancelBubble=!0;E&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){this.stopPropagation();this.stopImmediate=!0},toString:function(){return"[object Event]"}};Ka.prototype=Lb;"onmouseenter"in G||e.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){O[a]={type:b,fix:function(b,d){return function(c){var e=c.relatedTarget;if(!e||e!==b&&!(b.compareDocumentPosition(e)&16))return delete c.type,c.type=a,d.apply(this,arguments)}}}});e.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(a,b){v[a]&&!O.animationend&&(O.animationend={type:b})});if(!("onmousewheel"in m)){var Dc=void 0!==m.onwheel?"wheel":"DOMMouseScroll",Le="wheel"===Dc?"deltaY":"detail";O.mousewheel={type:Dc,fix:function(a,b){return function(c){c.wheelDelta=~~a._ms_wheel_+(0<c[Le]?-120:120);a._ms_wheel_=c.wheelDeltaY=c.wheelDelta;c.wheelDeltaX=0;Object.defineProperty&&Object.defineProperty(c,"type",{value:"mousewheel"});return b.apply(this,arguments)}}}}E||(delete ja.change,delete ja.select);e._nativeBind=E?function(a,b,c,d){a.addEventListener(b,c,!!d)}:function(a,b,c){a.attachEvent("on"+b,c)};e._nativeUnBind=E?function(a,b,c,d){a.removeEventListener(b,c,!!d)}:function(a,b,c){a.detachEvent("on"+b,c)};e.fireDom=function(a,b,c){if(m.createEvent){var d=m.createEvent("Events");d.initEvent(b,!0,!0,c);e.shadowCopy(d,c);a.dispatchEvent(d)}else if(G.contains(a)){d=m.createEventObject();c&&e.shadowCopy(d,c);try{a.fireEvent("on"+b,d)}catch(f){e.log("fireDom",b,"args error")}}};var Me=/^(?:mouse|contextmenu|drag)|click/;Ka.prototype.fixEvent=function(){null==this.which&&0===this.type.indexOf("key")&&(this.which=null!=this.charCode?this.charCode:this.keyCode);if(Me.test(this.type)&&!("pageX"in this)){var a=this.target.ownerDocument||m,a="BackCompat"===a.compatMode?a.body:a.documentElement;this.pageX=this.clientX+(a.scrollLeft>>0)-(a.clientLeft>>0);this.pageY=this.clientY+(a.scrollTop>>0)-(a.clientTop>>0);this.wheelDeltaY=~~this.wheelDelta;this.wheelDeltaX=0}};"oninput"in m.createElement("input")||(O.input={type:"propertychange",fix:function(a,b){return function(a){if("value"===a.propertyName)return a.type="input",b.apply(this,arguments)}}});var Mb=[];e.ready=function(a){Mb.push(a);e.isReady&&V()};e.ready(function(){e.scan&&e.scan(m.body)});A&&wd();var xd=/input|textarea|select/i;La.prototype={constructor:La,toDOM:function(){if(this.dom)return this.dom;var a=e._decode(this.nodeValue);return this.dom=m.createTextNode(a)},toHTML:function(){return this.nodeValue}};Ma.prototype={constructor:Ma,toDOM:function(){return this.dom?this.dom:this.dom=m.createComment(this.nodeValue)},toHTML:function(){return"\x3c!--"+this.nodeValue+"--\x3e"}};Na.prototype={constructor:Na,toDOM:function(){if(this.dom)return this.dom;var a,b=this.nodeName;a=e.modern&&Ne[b]?m.createElementNS("http://www.w3.org/2000/svg",b):e.modern||!Oe[b]&&!Pe.test(b)?m.createElement(b):yd(b);var b=this.props||{},c;for(c in b){var d=b[c];if(!1!==d&&Object(d)!==d)if(Ec[c]&&8>e.msie)Ec[c](a,d);else a.setAttribute(c,d+"")}var f=this.children||[];c=f[0]?f[0].nodeValue:"";switch(this.nodeName){case "script":a.type="noexec";a.text=c;a.type=b.type||"";break;case "noscript":a.textContent=c;case "style":case "xmp":case "template":try{a.innerHTML=c}catch(g){this.hackIE(a,this.nodeName,c,b)}break;case "option":9>x&&(a.text=c);default:!this.isVoidTag&&this.children&&this.children.forEach(function(b){return f&&a.appendChild(e.vdom(f,"toDOM"))})}return this.dom=a},hackIE:function(a,b,c){switch(b){case "style":a.setAttribute("type","text/css");a.styleSheet.cssText=c;break;case "xmp":case "noscript":a.textContent=c}},toHTML:function(){var a=[],b=this.props||{},c;for(c in b){var d=b[c];!1!==d&&Object(d)!==d&&a.push(c+"\x3d"+e.quote(b[c]+""))}a=a.length?" "+a.join(" "):"";a="\x3c"+this.nodeName+a;if(this.isVoidTag)return a+"/\x3e";a+="\x3e";this.children&&(a+=this.children.map(function(a){return a?e.vdom(a,"toHTML"):""}).join(""));return a+"\x3c/"+this.nodeName+"\x3e"}};var Ec={"class":function(a,b){a.className=b},style:function(a,b){a.style.cssText=b},type:function(a,b){try{a.type=b}catch(c){}},"for":function(a,b){a.setAttribute("for",b);a.htmlFor=b}},Ne=e.oneObject("circle,defs,ellipse,image,line,path,polygon,polyline,rect,symbol,text,use,g,svg"),Pe=/^\w+\:\w+/,Oe=e.oneObject("shape,line,polyline,rect,roundrect,oval,arc,curve,background,image,shapetype,group,fill,stroke,shadow, extrusion, textbox, imagedata, textpath");ka.prototype={constructor:ka,toDOM:function(){if(this.dom)return this.dom;var a=this.toFragment();this.split=a.lastChild;return this.dom=a},dispose:function(){this.toFragment();this.innerRender&&this.innerRender.dispose();for(var a in this)this[a]=null},toFragment:function(){var a=m.createDocumentFragment();this.children.forEach(function(b){return a.appendChild(e.vdom(b,"toDOM"))});return a},toHTML:function(){return(this.children||[]).map(function(a){return e.vdom(a,"toHTML")}).join("")}};e.mix(e,{VText:La,VComment:Ma,VElement:Na,VFragment:ka});var Qe={"#text":"VText","#document-fragment":"VFragment","#comment":"VComment"};e.vdomAdaptor=e.vdom=function(a,b){if(!a)return"toHTML"===b?"":m.createDocumentFragment();var c=a.nodeName;return c?e[Qe[c]||"VElement"].prototype[b].call(a):(new e.VFragment(a))[b]()};e.domize=function(a){return e.vdom(a,"toDOM")};var D={$id:void 0,$render:void 0,$track:void 0,$element:void 0,$watch:void 0,$fire:void 0,$events:void 0,$accessors:void 0,$hashcode:void 0,$vbthis:void 0,$vbsetter:void 0};e.pendingActions=[];e.inTransaction=0;e.inBatch=0;e.observerQueue=[];t.trackDeps=!1;e.track=function(){t.trackDeps&&e.log.apply(e,arguments)};var Qb=[];e.transaction=function(a,b,c){c=c||[];var d="transaction "+(a.name||a.displayName||"noop");e.inBatch++;e.inTransaction+=1;a=a.apply(b,c);Rb(d);return a};var Re=e.oneObject("break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile"),Cd=e.mix({Math:1,Date:1,$event:1,window:1,__vmodel__:1,avalon:1},Re),Gd=/(^|[^\w\u00c0-\uFFFF_])(@|##)(?=[$\w])/g,Fd=/\s*(\.|\|)\s*/g,Ed=/\|\|/g,Kd=/\(([^)]*)\)/,Jd=/\|(?=\?\?)/,Dd=/(^|[^/])\/(?!\/)(\[.+?]|\\.|[^/\\\r\n])+\/[gimyu]{0,5}(?=\s*($|[\r\n,.;})]))/g,Ad=/\.[\w\.\$]+/g,Hd=/(\{|\,)\s*([\$\w]+)\s*:/g,Id=/\|(\w+)/g,Bd=/[$a-zA-Z_][$a-zA-Z0-9_]*/g,Sb=new F(300),Ld=/^__vmodel__\.[$\w\.]+$/,Md=/__vmodel__\.([^(]+)\(([^)]*)\)/,Od=1;Pa.prototype={getValue:function(){var a=this.vm;try{return this.getter.call(a,a)}catch(b){e.log(this.getter+" exec error")}},setValue:function(a){var b=this.vm;this.setter&&this.setter.call(b,b,a)},get:function(a){a="action track "+this.type;this.deep&&(e.deepCollect=!0);e.inBatch++;var b=Pb(this,this.getValue);la(a);this.deep&&e.deepCollect&&(e.deepCollect=!1);return b},beforeUpdate:function(){var a=this.value;return this.oldValue=a&&a.$events?a.$model:a},update:function(a,b){var c=this.beforeUpdate(),d=this.value=this.get(),e=this.callback;e&&this.diff(d,c,a)&&e.call(this.vm,this.value,c,this.expr);this._isScheduled=!1},schedule:function(){this._isScheduled||(this._isScheduled=!0,e.Array.ensure(e.pendingActions,this),e.inBatch++,Ob(),la("schedule "+this.expr))},removeDepends:function(){var a=this;this.observers.forEach(function(b){e.Array.remove(b.observers,a)})},diff:function(a,b){return a!==b},dispose:function(){this.value=null;this.removeDepends();this.beforeDispose&&this.beforeDispose();for(var a in this)delete this[a]}};var Nd={vm:1,callback:1,observers:1,oldValue:1,value:1,getValue:1,setValue:1,get:1,removeDepends:1,beforeUpdate:1,update:1,dispose:1},Pd=1;ma.prototype={get:function(){this.collect();var a=this.value;if(a&&a.$events)if(Array.isArray(a))a.forEach(function(a){a&&a.$events&&a.$events.__dep__.collect()});else if(e.deepCollect)for(var b in a)a.hasOwnProperty(b);return this.value},collect:function(){var a="mutation "+this.expr;e.inBatch++;e.track(a,"\u8981\u88ab\u4e0a\u4ea4\u4e86");var b=e.trackingAction||null;null!==b?(e.track("\u5f81\u6536\u5230",this.expr),b.mapIDs[this.uuid]=this,this.isCollected=1):0!==this.observers.length||this.isAddToQueue||(this.isAddToQueue=!0,e.observerQueue.push(this));la(a)},updateVersion:function(){this.version=Math.random()+Math.random()},notify:function(){e.inBatch++;e.inTransaction+=1;for(var a=this.observers,b=0,c;c=a[b++];)c.schedule();Rb()},set:function(a){var b=this.value;if(a!==b){if(a){var b=b&&b.$hashcode,c=n.createProxy(a,this);c&&(b&&(c.$hashcode=b),a=c)}this.value=a;this.updateVersion();this.notify()}}};var Se=/(\?|if\b|\(.+\))/,Ud=function(a){function b(b,c,g){a.call(this,b,void 0,g);delete c.get;delete c.set;e.mix(this,c);this.deps={};this.type="computed";this.depsVersion={};this.isComputed=!0;this.trackAndCompute();"isStable"in this||(this.isStable=!Se.test(Qd(this.getter)))}Sd(b,a);var c=b.prototype;c.trackAndCompute=function(){this.isStable&&0<this.depsCount?this.getValue():Pb(this,this.getValue.bind(this))};c.getValue=function(){return this.value=this.getter.call(this.vm)};c.schedule=function(){for(var a=this.observers,b=a.length;b--;){var c=a[b];c.schedule&&c.schedule()}};c.shouldCompute=function(){if(this.isStable){var a=!1,b;for(b in this.deps)this.deps[b].version!==this.depsVersion[b]&&(a=!0,this.deps[b].version=this.depsVersion[b]);return a}return!0};c.set=function(){this.setter&&e.transaction(this.setter,this.vm,arguments)};c.get=function(){this.collect();1===e.inBatch?this.shouldCompute()&&(this.getValue(),this.updateVersion(),this.isJustChange=!0):this.shouldCompute()&&(this.trackAndCompute(),this.updateVersion());return this.value}}(ma);E&&(D.$mutations=!1);e.define=function(a){var b=a.$id;b||e.error("vm.$id must be specified");e.vmodels[b]&&e.warn("error:["+b+"] had defined!");a=n.modelFactory(a);return e.vmodels[b]=a};n.modelFactory=function(a,b){var c=a.$computed||{};delete a.$computed;var d=new Qa(a,b),f=d.$accessors,g=[];E&&n.hideProperty(d,"$mutations",{});for(var h in a)if(!(h in D)){var k=a[h];g.push(h);Td(h,k)&&(f[h]=Ra(h,k))}for(var l in c)l in D||(k=c[l],"function"===typeof k&&(k={get:k}),k&&k.get&&(k.getter=k.get,k.setter=k.set,e.Array.ensure(g,l),f[l]=Ra(l,k,!0)));c=n.createViewModel(d,f,d);n.afterCreate(c,d,g);return c};var Ub={};n.createProxy=function(a,b){if(a&&a.$events)return a;var c;Array.isArray(a)?c=n.listFactory(a,!1,b):Q(a)&&(c=n.modelFactory(a,b));return c};n.itemFactory=function(a,b){var c=a.$model,d=new Qa(c),f=e.shadowCopy(d.$accessors,a.$accessors),g=b.data,h;for(h in g){var k=c[h]=d[h]=g[h];f[h]=Ra(h,k)}c=Object.keys(c);f=n.createViewModel(d,f,d);n.afterCreate(f,d,c);return f};n.fuseFactory=function(a,b){var c=e.mix(a.$model,b.$model),d=new Qa(e.mix(c,{$id:a.$id+b.$id})),f=e.mix(d.$accessors,a.$accessors,b.$accessors),c=Object.keys(c),f=n.createViewModel(d,f,d);n.afterCreate(f,d,c);return f};var Tb={get:function(){return na(this)},set:e.noop,enumerable:!1,configurable:!0};n.toJson=na;n.modelAccessor=Tb;var Fc=N.splice,lb={set:function(a,b){if(a>>>0===a&&this[a]!==b){if(a>this.length)throw Error(a+"set\u65b9\u6cd5\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e0d\u80fd\u5927\u4e8e\u539f\u6570\u7ec4\u957f\u5ea6");this.splice(a,1,b)}},contains:function(a){return-1!==this.indexOf(a)},ensure:function(a){return this.contains(a)?!1:(this.push(a),!0)},pushArray:function(a){return this.push.apply(this,a)},remove:function(a){return this.removeAt(this.indexOf(a))},removeAt:function(a){return a>>>0===a?this.splice(a,1):[]},clear:function(){this.removeAll();return this},removeAll:function(a){var b=Array.isArray(a)?function(b){return-1!==a.indexOf(b)}:"function"===typeof a?a:!1;if(b)for(var c=this.length-1;0<=c;c--)b(this[c],c)&&Fc.call(this,c,1);else Fc.call(this,0,this.length);n.toModel(this);this.$events.__dep__.notify()}};"push pop shift unshift splice sort reverse".split(" ").forEach(function(a){var b=N[a];lb[a]=function(){var c=this.$events,d=n.listFactory(arguments,!0,c.__dep__),d=b.apply(this,d);n.toModel(this);c.__dep__.notify(a);return d}});n.listFactory=function(a,b,c){if(!b){for(var d in lb)n.hideProperty(a,d,lb[d]);E&&Object.defineProperty(a,"$model",n.modelAccessor);n.hideProperty(a,"$hashcode",e.makeHashCode("$"));n.hideProperty(a,"$events",{__dep__:c||new Depend})}b=a.$events&&a.$events.__dep__;c=0;for(d=a.length;c<d;c++){var f=a[c];Q(f)&&(a[c]=n.createProxy(f,b))}return a};var Sa=!0;try{Object.defineProperty({},"_",{value:"x"}),delete D.$vbsetter,delete D.$vbthis}catch(a){Sa=!1}var Vd={$vbthis:1,$vbsetter:1};n.hideProperty=Vb;n.fireFactory=function(a){return function(b,c){var d=a[b];if(Array.isArray(d))for(var e=0,g;g=d[e++];)g.callback.call(g.vm,c,g.value,g.expr)}};n.watchFactory=function(a){return function(b,c,d){var f=new Pa(a.__proxy__,{deep:d,type:"user",expr:b},c);a[b]?a[b].push(f):a[b]=[f];return function(){f.dispose();e.Array.remove(a[b],f);0===a[b].length&&delete a[b]}}};n.afterCreate=function(a,b,c){function d(b){return-1<("\u2625"+a.$track+"\u2625").indexOf("\u2625"+b+"\u2625")}var f=a.$accessors,g;for(g in D)9>e.msie&&void 0===b[g]||Vb(a,g,b[g]);for(g=0;g<c.length;g++){var h=c[g];h in f||(a[h]=9>e.msie&&"function"===typeof b[h]?b[h].bind(a):b[h])}a.$track=c.join("\u2625");9>e.msie&&(a.hasOwnProperty=d);a.$events.__proxy__=a};n.toModel=function(a){if(9>e.msie)return a.$model=n.toJson(a)};var mb=Object.defineProperties,Gc,I=new Date-0;if(!Sa&&("__defineGetter__"in e&&(Gc=function(a,b,c){"value"in c&&(a[b]=c.value);"get"in c&&a.__defineGetter__(b,c.get);"set"in c&&a.__defineSetter__(b,c.set);return a},mb=function(a,b){for(var c in b)b.hasOwnProperty(c)&&Gc(a,c,b[c]);return a}),9>x)){var Hc={};window.execScript("Function parseVB(code)\n\tExecuteGlobal(code)\nEnd Function","VBScript");var Te=function(a,b,c,d){var e=b[c];if(4===arguments.length)e.set.call(a,d);else return e.get.call(a)},mb=function(a,b,c){var d=[];d.push("\tPrivate [$vbsetter]","\tPublic  [$accessors]","\tPublic Default Function [$vbthis](ac"+I+", s"+I+")","\t\tSet  [$accessors] \x3d ac"+I+": set [$vbsetter] \x3d s"+I,"\t\tSet  [$vbthis]    \x3d Me","\tEnd Function");var f={$vbthis:!0,$vbsetter:!0,$accessors:!0};for(a in D)f[a]||(d.push("\tPublic ["+a+"]"),f[a]=!0);for(a in b)f[a]||(f[a]=!0,d.push("\tPublic Property Let ["+a+"](val"+I+")",'\t\tCall [$vbsetter](Me, [$accessors], "'+a+'", val'+I+")","\tEnd Property","\tPublic Property Set ["+a+"](val"+I+")",'\t\tCall [$vbsetter](Me, [$accessors], "'+a+'", val'+I+")","\tEnd Property","\tPublic Property Get ["+a+"]","\tOn Error Resume Next","\t\tSet["+a+'] \x3d [$vbsetter](Me, [$accessors],"'+a+'")',"\tIf Err.Number \x3c\x3e 0 Then","\t\t["+a+'] \x3d [$vbsetter](Me, [$accessors],"'+a+'")',"\tEnd If","\tOn Error Goto 0","\tEnd Property"));for(a in c)f[a]||(f[a]=!0,d.push("\tPublic ["+a+"]"));d.push("\tPublic [hasOwnProperty]");d.push("End Class");a=d.join("\r\n");c=Hc[a];c||(c=e.makeHashCode("VBClass"),window.parseVB("Class "+c+a),window.parseVB(["Function "+c+"Factory(acc, vbm)","\tDim o","\tSet o \x3d (New "+c+")(acc, vbm)","\tSet "+c+"Factory \x3d o","End Function"].join("\r\n")),Hc[a]=c);return window[c+"Factory"](b,Te)}}n.createViewModel=mb;var Ue=e.directive("important",{priority:1,getScope:function(a,b){var c=e.vmodels[a];if(c)return c;throw"error! no vmodel called "+a;},update:function(a,b,c){e.inBrowser&&(a=e.vdom(a,"toDOM"),1===a.nodeType&&(a.removeAttribute(b),e(a).removeClass("ms-controller")),b=e.vmodels[c])&&(b.$element=a,b.$render=this,b.$fire("onReady"),delete b.$events.onReady)}}).update;e.directive("controller",{priority:2,getScope:function(a,b){var c=e.vmodels[a];return c?(c.$render=this,b?n.fuseFactory(b,c):c):b},update:Ue});e.directive("skip",{delay:!0});var Ic={},nb=e.directive("css",{diff:function(a,b){if(Object(a)===a){a=n.toJson(a);if(Array.isArray(a)){var c={};a.forEach(function(a){a&&e.shadowCopy(c,a)});a=c;Ic[this.type]||(e.warn("ms-"+this.type+"\u6307\u4ee4\u7684\u503c\u4e0d\u5efa\u8bae\u4f7f\u7528\u6570\u7ec4\u5f62\u5f0f\u4e86\uff01"),Ic[this.type]=1)}var d=!1,f={};if(b){if(this.deep)for(var g in a){if(!Ta(a[g],b[g],4))return this.value=a,!0;f[g]=a[g]}else for(g in a)a[g]!==b[g]&&(d=!0),f[g]=a[g];for(g in b)g in f||(d=!0,f[g]="")}else f=a,d=!0;if(d)return this.value=f,!0}return!1},update:function(a,b){var c=a.dom;if(c&&1===c.nodeType){var c=e(c),d;for(d in b)c.css(d,b[d])}}}).diff,Y={TransitionEvent:"transitionend",WebKitTransitionEvent:"webkitTransitionEnd",OTransitionEvent:"oTransitionEnd",otransitionEvent:"otransitionEnd"},oa=void 0,va=void 0,ob=void 0,J=void 0,Xa=void 0,Wa=void 0;for(J in Y){if(v[J]){va=Y[J];break}try{document.createEvent(J);va=Y[J];break}catch(a){}}"string"===typeof va&&(oa=!0,Wa=va);Y={AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"};for(J in Y)if(v[J]){ob=Y[J];break}"string"===typeof ob&&(oa=!0,Xa=ob);var Ve=e.directive("effect",{priority:5,diff:function(a){var b=this.node;"string"===typeof a&&(this.value=a={is:a},e.warn("ms-effect\u7684\u6307\u4ee4\u503c\u4e0d\u518d\u652f\u6301\u5b57\u7b26\u4e32,\u5fc5\u987b\u662f\u4e00\u4e2a\u5bf9\u8c61"));this.value=b.effect=a;var c=this;return nb.call(this,a,this.oldValue)?(setTimeout(function(){b.animating=!0;Ve.update.call(c,b,b.effect)}),b.animating=!1,!0):!1},update:function(a,b,c){if((a=a.dom)&&1===a.nodeType){b=b||c;c=b.is;var d=e.effects[c];if(d){var f={},g=We[b.action];if("function"!==typeof pb.prototype[g])e.warn("action is undefined");else{var h=new e.Effect(a);e.mix(f,d,b,{action:g});if(f.queue)Ua.push(function(){h[g](f)}),Xb();else h[g](f);return!0}}else e.warn(c+" effect is undefined")}}}),We={"true":"enter","false":"leave",enter:"enter",leave:"leave",move:"move",undefined:"enter"},Ua=[];e.effects={};e.effect=function(a,b){var c=e.effects[a]=b||{};oa&&!1!==c.css&&(c.enterClass||(c.enterClass=a+"-enter"),c.enterActiveClass||(c.enterActiveClass=c.enterClass+"-active"),c.leaveClass||(c.leaveClass=a+"-leave"),c.leaveActiveClass||(c.leaveActiveClass=c.leaveClass+"-active"));return c};var pb=function(a){this.dom=a};e.Effect=pb;pb.prototype={enter:Va("Enter"),leave:Va("Leave"),move:Va("Move")};var Zb=new F(128);e.applyEffect=function(a,b,c){var d=c.cb;if((b=b.effect)&&a&&1===a.nodeType){a=c.hook;var f=b[a];d&&(Array.isArray(f)?f.push(d):b[a]=f?[f,d]:[d]);c.action||(c.action=c.hook.replace(/^on/,"").replace(/Done$/,"").toLowerCase());e.directives.effect.update(vnode,b,e.shadowCopy({},c))}else d&&d(a)};var $d=e.cssName("transition-duration"),Zd=e.cssName("animation-duration"),Yd=/\d+s$/;e.parseDisplay=ca;e.directive("visible",{diff:function(a,b){var c=!!a;if(void 0===b||c!==b)return this.value=c,!0},ready:!0,update:function(a,b){var c=a.dom;if(c&&1===c.nodeType){var d=c.style.display,f;b?("none"===d&&(f=a.displayValue,f||(c.style.display="",""===c.style.cssText&&c.removeAttribute("style"))),""===c.style.display&&"none"===e(c).css("display")&&e.contains(c.ownerDocument,c)&&(f=ca(c))):"none"!==d&&(f="none",a.displayValue=d);e.applyEffect(c,a,{hook:b?"onEnterDone":"onLeaveDone",cb:function(){void 0!==f&&(c.style.display=f)}})}}});e.directive("text",{delay:!0,init:function(){var a=this.node;a.isVoidTag&&e.error("\u81ea\u95ed\u5408\u5143\u7d20\u4e0d\u80fd\u4f7f\u7528ms-text");var b={nodeName:"#text",nodeValue:this.getValue()};a.children.splice(0,a.children.length,b);A&&(e.clearHTML(a.dom),a.dom.appendChild(e.vdom(b,"toDOM")));this.node=b;this.type=this.name="expr";var c=e.directives.expr,d=this;this.callback=function(a){c.update.call(d,d.node,a)}}});e.directive("expr",{update:function(a,b){a.nodeValue=b;a.dom&&""===b&&(b="\u200b");a.dom.data=b}});e.directive("attr",{diff:nb,update:function(a,b){var c=a.props,d;for(d in b)!1===!!b[d]?delete c[d]:c[d]=b[d];if((c=a.dom)&&1===c.nodeType)for(var f in b)try{var g=b[f];if(0===f.indexOf("data-")||Ce.test(c))c.setAttribute(f,g);else{var h=gb[f]||f;"boolean"===typeof c[h]&&(c[h]=!!g);if(!1===g)c.removeAttribute(h);else if(8>x&&/[A-Z]/.test(h))c[h]=g+"";else{var k;if(k=!e.modern){d=c;var l=d.nodeName;k=l.toLowerCase()===l&&!!d.scopeName&&""===d.outerText}var r;if(!(r=k)){var n=c.nodeName;d=n+":"+f;r=d in hb?hb[d]:hb[d]=f in m.createElement(n)}r?(("href"===f||"src"===f)&&8>x&&(g=String(g).replace(De,"\x26")),c[h]=g+""):c.setAttribute(f,g)}}}catch(q){e.log(String(q.message).trim(),f,g)}}});e.directive("html",{update:function(a,b){this.beforeDispose();this.innerRender=e.scan('\x3cdiv class\x3d"ms-html-container"\x3e'+b+"\x3c/div\x3e",this.vm,function(){var b=this.root;a.children&&(a.children.length=0);a.children=b.children;this.root=a;a.dom&&e.clearHTML(a.dom)})},beforeDispose:function(){this.innerRender&&this.innerRender.dispose()},delay:!0});e.directive("if",{delay:!0,priority:5,init:function(){this.placeholder=m.createComment("if");var a=this.node.props;delete a["ms-if"];delete a[":if"];this.fragment=e.vdom(this.node,"toHTML")},diff:function(a,b){var c=!!a;if(void 0===b||c!==b)return this.value=c,!0},update:function(a,b){if(void 0===this.isShow&&b)ac(this,a);else{this.isShow=b;var c=this.placeholder;if(b){var d=c.parentNode;ac(this,a);d&&d.replaceChild(a.dom,c)}else{this.beforeDispose();a.nodeValue="if";a.nodeName="#comment";delete a.children;var e=a.dom,d=e&&e.parentNode;a.dom=c;d&&d.replaceChild(c,e)}}},beforeDispose:function(){this.innerRender&&this.innerRender.dispose()}});e.directive("on",{beforeInit:function(){this.getter=e.noop},init:function(){var a=this.node,b=this.name.replace("ms-on-","e").replace("-","_")+"_"+this.expr.replace(/\s/g,"").replace(/[^$a-z]/ig,function(a){return a.charCodeAt(0)}),c=e.eventListeners[b];if(!c){var d=W(this.expr),c=d[0],d=d[1],c=Oa(c);d&&(d=d.replace(/__value__/g,"$event"),d+="\nif($event.$return){\n\treturn;\n}");c=["try{","\tvar __vmodel__ \x3d this;","\t"+d,"\treturn "+c,'}catch(e){avalon.log(e, "in on dir")}'].filter(function(a){return/\S/.test(a)});c=new Function("$event",c.join("\n"));c.uuid=b;e.eventListeners[b]=c}a=e.vdom(a,"toDOM");a._ms_context_=this.vm;this.eventType=this.param.replace(/\-(\d)$/,"");delete this.param;e(a).bind(this.eventType,c)},beforeDispose:function(){e(this.node.dom).unbind(this.eventType)}});var Xe=/\s+as\s+([$\w]+)/,Ye=/^[$a-zA-Z_][$a-zA-Z0-9_]*$/,Ze=/^(null|undefined|NaN|window|this|\$index|\$id)$/,$e=/[$\w_]+/g;e.directive("for",{delay:!0,priority:3,beforeInit:function(){var a=this.expr,b,a=a.replace(Xe,function(a,c){!Ye.test(c)||Ze.test(c)?e.error("alias "+c+" is invalid --- must be a valid JS identifier which is not a reserved name."):b=c;return""}),a=a.split(" in "),c=a[0].match($e);1===c.length&&c.unshift("$key");this.expr=a[1];this.keyName=c[0];this.valName=c[1];this.signature=e.makeHashCode("for");b&&(this.asName=b);delete this.param},init:function(){var a=this.userCb;"string"===typeof a&&a&&(a=W(a,"for"),a=Oa(a[0]),this.userCb=new Function("$event","var __vmodel__ \x3d this\nreturn "+a));this.node.forDir=this;this.fragment=["\x3cdiv\x3e",this.fragment,"\x3c!--",this.signature,"--\x3e\x3c/div\x3e"].join("");this.cache={}},diff:function(a,b){if(!this.updating){this.updating=!0;var c=ae(this,a);if(void 0===this.oldTrackIds)return!0;if(this.oldTrackIds!==c)return this.oldTrackIds=c,!0}},update:function(){if(this.preFragments){ce(this);for(var a=this.begin.dom,b=a.parentNode,c=this.fragments,d=this.end.dom,e=0,g;g=c[e];e++)if(g._dispose)c.splice(e,1),e--,g.dispose();else{if(g.oldIndex!==g.index){var h=g.toFragment();b.insertBefore(h,a.nextSibling||d)}a=g.split}a=this.parentChildren;b=a.indexOf(this.begin);d=a.indexOf(this.end);c.splice.apply(a,[b+1,d-b].concat(c))}else this.fragments=this.fragments||[],be(this);this.userCb&&this.userCb.call(this.vm,{type:"rendered",target:this.begin.dom,signature:this.signature});delete this.updating},beforeDispose:function(){this.fragments.forEach(function(a){a.dispose})}});e.directive("class",{diff:function(a,b){var c=this.type,d=this.node,e=d.classEvent||{};"hover"===c?(e.mouseenter=pa,e.mouseleave=da):"active"===c&&(e.tabIndex=d.props.tabindex||-1,e.mousedown=pa,e.mouseup=da,e.mouseleave=da);d.classEvent=e;e=dc(a);if(b!==e)return this.value=e,d["change-"+c]=e,!0},update:function(a,b){var c=a.dom;if(c&&1==c.nodeType){var d=this.type,f="change-"+d,g=a.classEvent;if(g){for(var h in g)"tabIndex"===h?c[h]=g[h]:e.bind(c,h,g[h]);a.classEvent={}}["class","hover","active"].forEach(function(a){if(d===a)if("class"===a)c&&(a=c.getAttribute("change-class"),a!==b&&(e(c).removeClass(a).addClass(b),c.setAttribute("change-class",b)));else{var g=c.getAttribute(f);g&&e(c).removeClass(g);c.setAttribute("change-"+a,b)}})}}});y.active=y.hover=y["class"];var ec={mouseenter:"change-hover",mouseleave:"change-hover",mousedown:"change-active",mouseup:"change-active"};pa.uuid||(pa.uuid=za("e"));da.uuid||(da.uuid=za("e"));var Jc=/\|\s*change\b/,Kc=/\|\s*debounce(?:\(([^)]+)\))?/,Lc=!0;try{var qb={},Mc=HTMLInputElement.prototype,Nc=HTMLTextAreaElement.prototype,Oc=function(a){qb[this.tagName].call(this,a);a=this._ms_duplex_;!this.caret&&a&&a.isString&&a.duplexCb.call(this,{type:"setter"})};Object.getOwnPropertyNames(HTMLInputElement.prototype);qb.INPUT=Object.getOwnPropertyDescriptor(Mc,"value").set;Object.defineProperty(Mc,"value",{set:Oc});qb.TEXTAREA=Object.getOwnPropertyDescriptor(Nc,"value").set;Object.defineProperty(Nc,"value",{set:Oc});Lc=!1}catch(a){}var fa={input:function(){this.node.props.value=this.value+"";this.dom.value=this.value},updateChecked:function(a,b){a.dom&&(a.dom.defaultChecked=a.dom.checked=b)},radio:function(){var a=this.node,b=a.props.value,b=this.isChecked?!!this.value:this.value+""===b;a.props.checked=b;fa.updateChecked(a,b)},checkbox:function(){var a=this.node,b=a.props,c=b.value+"",d=[].concat(this.value).some(function(a){return a+""===c});b.defaultChecked=b.checked=d;fa.updateChecked(a,d)},select:function(){var a=Array.isArray(this.value)?this.value.map(String):this.value+"";fc(this.node,a)},contenteditable:function(){for(var a=ba(this.value),b=m.createDocumentFragment(),c=0,d;d=a[c++];)d=e.vdom(d,"toDOM"),b.appendChild(d);e.clearHTML(this.dom).appendChild(b);b=this.node.children;b.length=0;Array.prototype.push.apply(b,a);this.duplexCb.call(this.dom)}},ea={input:function(a){var b=this.dom;a=b[a||"value"];var c=this.parseValue(a);this.value=a;this.setValue(c);qa(this);a=this.pos;b.caret&&this.setCaret(b,a)},radio:function(){this.isChecked?(this.setValue(!this.value),qa(this)):(ea.input.call(this),this.value=NaN)},checkbox:function(){var a=this.value;Array.isArray(a)||(e.warn("ms-duplex\u5e94\u7528\u4e8echeckbox\u4e0a\u8981\u5bf9\u5e94\u4e00\u4e2a\u6570\u7ec4"),a=[a]);var b=this.dom.checked?"ensure":"remove";if(a[b]){var c=this.parseValue(this.dom.value);a[b](c);qa(this)}this.__test__=a},select:function(){var a=this,b=e(a.dom).val();b+""!==this.value+""&&(b=Array.isArray(b)?b.map(function(b){return a.parseValue(b)}):a.parseValue(b),a.setValue(b),qa(a))},contenteditable:function(){ea.input.call(this,"innerHTML")}};B(ic);B(jc);B(Za);B($a);B(w);B(hc);B(H);B(ra);e.directive("duplex",{priority:9999999,beforeInit:function(){var a=this.expr;Jc.test(a)&&(this.isChanged=!0,a=a.replace(Jc,""));var b=a.match(Kc);b&&(a=a.replace(Kc,""),this.isChanged||(this.debounceTime=parseInt(b[1],10)||300));this.expr=a},init:function(){var a=this.node,b=a.props.type;this.parseValue=de;var c=this.param,d,e=!1,c=c?c.split("-").map(function(a){"checked"===a&&(e=!0);return a}):[];a.duplex=this;Da.test(b)&&e&&(c=[],d="radio",this.isChecked=e);this.parsers=c;/input|textarea|select/.test(a.nodeName)?d||(d="select"===a.nodeName?"select":"checkbox"===b?"checkbox":"radio"===b?"radio":"input"):"contenteditable"in a.props&&(d="contenteditable");this.dtype=d;"input"!==d&&"contenteditable"!==d?(delete this.isChange,delete this.debounceTime):this.isChecked||(this.isString=!0);if(a=a.props["data-duplex-changed"])a=W(a,"xx"),a=Oa(a[0]),this.userCb=new Function("$event","var __vmodel__ \x3d this\nreturn "+a)},diff:function(a,b){if(Array.isArray(a)){if(a+""!==this.compareVal)return this.compareVal=a+"",!0}else if(a=this.parseValue(a),this.isChecked||(this.value=a+=""),a!==this.compareVal)return this.compareVal=a,!0},update:function(a,b){var c=a.dom;if(!this.dom){this.dom=c;this.duplexCb=w;c._ms_duplex_=this;var d={};switch(this.dtype){case "radio":case "checkbox":d.click=w;break;case "select":d.change=w;break;case "contenteditable":this.isChanged?d.blur=w:e.modern?(v.webkitURL?d.webkitEditableContentChanged=w:v.MutationEvent&&(d.DOMCharacterDataModified=w),d.input=w):(d.keydown=ra,d.paste=H,d.cut=H,d.focus=$a,d.blur=Za);break;case "input":this.isChanged?d.change=w:10>x?(d.propertychange=hc,d.paste=H,d.cut=H,d.keyup=ra):(d.input=w,d.compositionstart=Za,d.compositionend=$a,/\[native code\]/.test(v.Int8Array)||(d.keydown=ra,d.paste=H,d.cut=H,v.netscape&&(d.DOMAutoComplete=w)))}/password|text/.test(c.type)&&(d.focus=ic,d.blur=jc,this.getCaret=fe,this.setCaret=ee);for(var f in d)e.bind(c,f,d[f]);d=a.duplex;if((f=a.rules)&&!d.validator)for(;c&&1===c.nodeType;){var g=c._ms_validate_;if(g){d.rules=f;d.validator=g;e.Array.ensure(g.fields,d)&&g.addField(d);break}c=c.parentNode}}kc.call(this,e.msie,Lc);fa[this.dtype].call(this)}});e.__pollValue=kc;if(8>e.msie){var af=fa.updateChecked;fa.updateChecked=function(a,b){var c=a.dom;c&&setTimeout(function(){af(a,b);c.firstCheckedIt=1},c.firstCheckedIt?31:16)}}e.directive("rules",{diff:function(a){if(Q(a)){var b=this.node;b.rules=n.toJson(a);b.duplex&&(b.duplex.rules=b.rules);return!0}}});var bf=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/i,cf=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/;e.shadowCopy(e.validators,{pattern:{message:"\u5fc5\u987b\u5339\u914d{{pattern}}\u8fd9\u6837\u7684\u683c\u5f0f",get:function(a,b,c){var d=b.dom;b=b.data;"regexp"!==e.type(b.pattern)&&(d=d.getAttribute("pattern"),b.pattern=new RegExp("^(?:"+d+")$"));c(b.pattern.test(a));return a}},digits:{message:"\u5fc5\u987b\u6574\u6570",get:function(a,b,c){c(/^\-?\d+$/.test(a));return a}},number:{message:"\u5fc5\u987b\u6570\u5b57",get:function(a,b,c){c(!!a&&isFinite(a));return a}},norequired:{message:"",get:function(a,b,c){c(!0);return a}},required:{message:"\u5fc5\u987b\u586b\u5199",get:function(a,b,c){c(""!==a);return a}},equalto:{message:"\u5bc6\u7801\u8f93\u5165\u4e0d\u4e00\u81f4",get:function(a,b,c){b=e(document.getElementById(String(b.data.equalto))).val()||"";c(a===b);return a}},date:{message:"\u65e5\u671f\u683c\u5f0f\u4e0d\u6b63\u786e",get:function(a,b,c){b=b.data;if("regexp"===e.type(b.date))c(b.date.test(a));else{a:{if("string"===typeof a&&a){var d=a.split("-");if(3===d.length&&4===d[0].length){b=~~d[0];var f=~~d[1]-1,d=~~d[2],g=new Date(b,f,d);b=g.getFullYear()===b&&g.getMonth()===f&&g.getDate()===d;break a}}b=!1}c(b)}return a}},url:{message:"URL\u683c\u5f0f\u4e0d\u6b63\u786e",get:function(a,b,c){c(cf.test(a));return a}},email:{message:"email\u683c\u5f0f\u4e0d\u6b63\u786e",get:function(a,b,c){c(bf.test(a));return a}},minlength:{message:"\u6700\u5c11\u8f93\u5165{{minlength}}\u4e2a\u5b57",get:function(a,b,c){b=parseInt(b.data.minlength,10);c(a.length>=b);return a}},maxlength:{message:"\u6700\u591a\u8f93\u5165{{maxlength}}\u4e2a\u5b57",get:function(a,b,c){b=parseInt(b.data.maxlength,10);c(a.length<=b);return a}},min:{message:"\u8f93\u5165\u503c\u4e0d\u80fd\u5c0f\u4e8e{{min}}",get:function(a,b,c){b=parseInt(b.data.min,10);c(parseFloat(a)>=b);return a}},max:{message:"\u8f93\u5165\u503c\u4e0d\u80fd\u5927\u4e8e{{max}}",get:function(a,b,c){b=parseInt(b.data.max,10);c(parseFloat(a)<=b);return a}},chs:{message:"\u5fc5\u987b\u662f\u4e2d\u6587\u5b57\u7b26",get:function(a,b,c){c(/^[\u4e00-\u9fa5]+$/.test(a));return a}}});var P=e.directive("validate",{diff:function(a){var b=this.node;if(!b.validator&&Q(a)){b.vmValidator=a;a=n.toJson(a);b.validator=a;for(var c in P.defaults)a.hasOwnProperty(c)||(a[c]=P.defaults[c]);a.fields=a.fields||[];return!0}},update:function(a){function b(){P.validateAll.call(c,c.onValidateAll)}var c=a.validator,d=a.dom;c.dom=d;d._ms_validate_=c;var f=a.vmValidator;try{f.onManual=b}catch(g){}delete a.vmValidator;d.setAttribute("novalidate","novalidate");c.validateAllInSubmit&&e.bind(d,"submit",function(a){a.preventDefault();b()});"function"===typeof c.onInit&&c.onInit.call(d,{type:"init",target:d,validator:c})},validateAll:function(a){var b=this,c="function"===typeof a?a:b.onValidateAll;a=b.fields.filter(function(a){return(a=a.dom)&&!a.disabled&&b.dom.contains(a)}).map(function(a){return P.validate(a,!0)});var d={};return Promise.all(a).then(function(a){a=a.concat.apply([],a);b.deduplicateInValidateAll&&(a=a.filter(function(a){a=a.element;a=a.uniqueID||(a.uniqueID=setTimeout("1"));return d[a]?!1:d[a]=!0}));c.call(b.dom,a)})},addField:function(a){var b=this,c=a.dom;!b.validateInKeyup||a.isChanged||a.debounceTime||e.bind(c,"keyup",function(c){b.validate(a,0,c)});b.validateInBlur&&e.bind(c,"blur",function(c){b.validate(a,0,c)});b.resetInFocus&&e.bind(c,"focus",function(d){b.onReset.call(c,d,a)})},validate:function(a,b,c){var d=[],f=a.value,g=a.dom;"function"!==typeof Promise&&e.error("please npm install es6-promise or bluebird");if(!g.disabled){var h=a.rules;if(!h.norequired||""!==f)for(var k in h){var l=h[k];if(!1!==l){var m=e.validators[k],n;d.push(new Promise(function(a,b){n=a}));a.data={};a.data[k]=l;m.get(f,a,function(b){b?n(!0):(b={element:g,data:a.data,message:g.getAttribute("data-"+k+"-message")||g.getAttribute("data-message")||m.message,validateRule:k,getMessage:ge},n(b))})}}return Promise.all(d).then(function(d){d=d.filter(function(a){return"object"===typeof a});if(!b){var e=a.validator;d.length?e.onError.call(g,d,c):e.onSuccess.call(g,d,c);e.onComplete.call(g,d,c)}return d})}}}),he=/\\?{{([^{}]+)\}}/gm;P.defaults={validate:P.validate,addField:P.addField,onError:e.noop,onSuccess:e.noop,onComplete:e.noop,onManual:e.noop,onReset:e.noop,onValidateAll:e.noop,validateInBlur:!0,validateInKeyup:!0,validateAllInSubmit:!0,resetInFocus:!0,deduplicateInValidateAll:!1};var Pc=e.oneObject("animationend,blur,change,input,click,dblclick,focus,keydown,keypress,keyup,mousedown,mouseenter,mouseleave,mousemove,mouseout,mouseover,mouseup,scan,scroll,submit","on"),ke={"#text":1,"#comment":1,script:1,style:1,noscript:1};e.scan=function(a,b,c){return new mc(a,b,c||e.noop)};var wa;mc.prototype={init:function(){var a;if(this.root&&0<this.root.nodeType)a=[Nb(this.root)],bb(this.root);else if("string"===typeof this.root)a=ba(this.root);else return e.warn("avalon.scan first argument must element or HTML string");this.root=a[0];this.vnodes=a;this.scanChildren(a,this.vm,!0)},scanChildren:function(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];switch(e.nodeName){case "#text":b&&this.scanText(e,b);break;case "#comment":b&&this.scanComment(e,b,a);break;case "#document-fragment":this.scanChildren(e.children,b,!1);break;default:this.scanTag(e,b,a,!1)}}c&&this.complete()},scanText:function(a,b){t.rexpr.test(a.nodeValue)&&this.bindings.push([a,b,{nodeValue:a.nodeValue}])},scanComment:function(a,b,c){0===a.nodeValue.indexOf("ms-for:")&&this.getForBinding(a,b,c)},scanTag:function(a,b,c,d){var f={},g=a.props,h,k,l;for(l in g){var m=g[l],n=l;":"===l.charAt(0)&&(l="ms-"+l.slice(1));if(0===l.indexOf("ms-")){f[l]=m;var q=l.match(/\w+/g)[1],q=Pc[q]||q;y[q]||e.warn(l+" has not registered!");h=!0}"ms-for"===l&&(k=m,delete g[n])}var p=f["ms-important"]||f["ms-controller"];if(p){if((l=e.serverTemplates)&&l[p]){e.log("\u524d\u7aef\u518d\u6b21\u6e32\u67d3\u540e\u7aef\u4f20\u8fc7\u6765\u7684\u6a21\u677f");var f=ba(tmpl)[0],t;for(t in f)a[t]=f[t];delete l[p];this.scanTag(a,b,c,d);return}var q=f["ms-important"]===p?"important":"controller",u="ms-"+q in g?"ms-"+q:":"+q;A&&delete g[u];var v=y[q];if(b=v.getScope.call(this,p,b))(d=g["class"])&&(g["class"]=(" "+d+" ").replace(" ms-controller ","").trim());else return;var w=this;b.$render=w;this.callbacks.push(function(){v.update.call(w,a,u,p)})}if(k)return a.dom&&a.dom.removeAttribute(n),this.getForBindingByElement(a,b,c,k);/^ms\-/.test(a.nodeName)&&(g.is=a.nodeName);g.is&&(f["ms-widget"]||(f["ms-widget"]="{}"),h=!0);h&&this.bindings.push([a,b,f]);c=a.children;!Ga[a.nodeName]&&c&&c.length&&!Z(f)&&this.scanChildren(c,b,!1)},complete:function(){this.yieldDirectives();this.beforeReady();if(A){var a=this.root;if(A){var b=e.vdom(a,"toDOM");ab(b,a.children)}}for(this.mount=!0;a=this.callbacks.pop();)a();this.optimizeDirectives()},yieldDirectives:function(){for(var a;a=this.bindings.shift();){var b=a[0],c=a[1],d=a[2],f=[];if("nodeValue"in d){f=d.nodeValue.trim().replace(/\n\r?/g,"");a=[];do{var d=f.indexOf(t.openTag),d=-1===d?f.length:d,g=f.slice(0,d);/\S/.test(g)&&a.push(e.quote(e._decode(g)));if(f=f.slice(d+t.openTag.length)){d=f.indexOf(t.closeTag);g=f.slice(0,d);g=e.unescapeHTML(g);if(/\|\s*\w/.test(g)){var h=W(g,"nodeValue");h[1]&&(g=h[1].replace(/__value__\)$/,h[0]+")"))}a.push(g);f=f.slice(d+t.closeTag.length)}}while(f.length);f=[{expr:a.join("+"),name:"expr",type:"expr"}]}else if(!("ms-skip"in d)){var f=d,d=a[0],g={},h=[],k=void 0;for(k in f){var l=f[k],m=k.split("-"),n=k in d.props?k:":"+k.slice(3);Pc[m[1]]&&m.splice(1,0,"on");"on"===m[1]&&(m[3]=parseFloat(m[3])||0);var q=m[1];if("controller"!==q&&"important"!==q&&y[q]&&(n={type:q,param:m[2],attrName:n,name:m.join("-"),expr:l,priority:y[q].priority||100*q.charCodeAt(0)},"on"===q&&(n.priority+=m[3]),!g[n.name]&&(g[n.name]=l,h.push(n),"for"===q))){h=[e.mix(n,a[3])];break}}f=h.sort(je)}for(a=0;d=f[a++];)if(g=y[d.type],A||!/on|duplex|active|hover/.test(d.type))g.beforeInit&&g.beforeInit.call(d),d=new ie(c,d,b,this),this.directives.push(d)}},optimizeDirectives:function(){for(var a=0,b;b=this.directives[a++];)b.callback=y[b.type].update,b.update=function(){var a=this.beforeUpdate(),b=this.value=this.get();if(this.callback&&this.diff(b,a)){this.callback(this.node,this.value);var f=this.vm,g=f.$render,h=f.$events.onViewChange;h&&g&&g.root&&!e.viewChanging&&(wa&&(clearTimeout(wa),wa=null),wa=setTimeout(function(){h.forEach(function(a){a.callback.call(f,{type:"viewchange",target:g.root,vmodel:f})})}))}this._isScheduled=!1},b._isScheduled=!1},dispose:function(){for(var a=this.directives||[],b=0,c;c=a[b++];)c.dispose();for(b in this)"dispose"!==b&&delete this[b]},getForBinding:function(a,b,c,d){var f=a.nodeValue.replace("ms-for:","").trim();a.nodeValue="ms-for:"+f;var g=lc(c,a),h=g.end,k=e.vdom(g,"toHTML");c.splice(g.start,g.length);a.props={};this.bindings.push([a,b,{"ms-for":f},{begin:a,end:h,expr:f,userCb:d,fragment:k,parentChildren:c}])},getForBindingByElement:function(a,b,c,d){var e=c.indexOf(a),g=a.props;d={nodeName:"#comment",nodeValue:"ms-for:"+d};g.slot&&(d.slot=g.slot,delete g.slot);c.splice(e,1,d,a,{nodeName:"#comment",nodeValue:"ms-for-end:"});this.getForBinding(d,b,c,g["data-for-rendered"])}};var ne=e.oneObject("onInit,onReady,onViewChange,onDispose,onEnter,onLeave"),rb=[];e.directive("widget",{delay:!0,priority:4,deep:!0,init:function(){var a=this.node;this.cacheVm=!!a.props.cached;if(a.dom&&"#comment"===a.nodeName)var b=a.dom;var c=this.getValue(),d=le(c),f=a.props.is||d.is;this.is=f;c=e.components[f];if(!("fragment"in this))if(a.isVoidTag)this.fragment=!1;else{var g=a.children[0];this.fragment=g&&g.nodeValue?g.nodeValue:e.vdom(a.children,"toHTML")}if(c){this.readyState=1;var h=e.vmodels[d.id||d.$id],g=!1;if(h)this.comVm=d=h,nc(this,d.$render),g=!0;else{d=me(c,d,f);X(d,a,"Init");this.comVm=d;var k=e.scan(c.template,d);d.$render=k;nc(this,k);var l=[],f=[];if(this.fragment||c.soleSlot){h=e.scan("\x3cdiv\x3e"+(this.fragment||"{{##"+c.soleSlot+"}}")+"\x3c/div\x3e",this.fragment?this.vm:d,function(){l=this.root.children});f=h.directives;this.childBoss=h;for(var m in h)delete h[m]}Array.prototype.push.apply(k.directives,f);m=[];var n={};c.soleSlot?m=l:l.forEach(function(a,b){if(a.slot){var c=lc(l,a);c.push(c.end);c.unshift(a);n[a.slot]=c}else a.props&&(c=a.props.slot)&&(delete a.props.slot,Array.isArray(n[c])?n[c].push(a):n[c]=[a])});c.soleSlot?qc(k.vnodes,m):rc(k.vnodes,n)}b&&(c=e.vdom(a,"toDOM"),b.parentNode.replaceChild(c,b),d.$element=k.root.dom=c,delete this.reInit);bb(a.dom);d.$element=a.dom;ab(a.dom,a.children);g?X(d,a,"Enter"):X(d,a,"Ready")}else this.readyState=0,a.nodeName="#comment",a.nodeValue="unresolved component placeholder",delete a.dom,e.Array.ensure(rb,this)},diff:function(a,b){if(nb.call(this,a,b))return!0},update:function(a,b){this.oldValue=b;switch(this.readyState){case 0:this.reInit&&this.init();break;case 1:this.readyState++;break;default:this.readyState++;var c=this.comVm;e.viewChanging=!0;e.transaction(function(){for(var a in b)c.hasOwnProperty(a)&&(c[a]=b[a])});X(c,a,"ViewChange");delete e.viewChanging}},beforeDispose:function(){var a=this.comVm;this.cacheVm?X(a,this.node,"Leave"):(X(a,this.node,"Dispose"),a.$hashcode=!1,delete e.vmodels[a.$id],this.innerRender&&this.innerRender.dispose())}});e.components={};e.component=function(a,b){e.components[a]=b;for(var c,d=0;c=rb[d];d++)c.is===a&&(rb.splice(d,1),c.reInit=!0,delete c.value,c.update(),d--)};return e});
