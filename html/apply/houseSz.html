<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>温州鹿城房产管理系统</title>
    <link href="../../bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../plugins/daterangepicker/daterangepicker.css">
    <link rel="stylesheet" href="../../plugins/jquery/alert/css/xcConfirm.css">
    <link rel="stylesheet" href="../../plugins/toastr/toastr.min.css">
    <link rel="stylesheet" href="../../css/base.css">
    <link rel="stylesheet" href="../../css/common.css">
    <style>
        .table-container{
            height: calc(100% - 20px);;
        }
        .houseTable>thead th,.houseTable tbody td{
            text-align: center;
        }
        .wzlc-menuList li.Apply{
            height:462px;
        }
    </style>
</head>
<body>
<header>
    <div  class="ysh-wzlcHead">
        <div class="ysh-wzlcTitle">
            <img class="wzlcLogo" src="../../images/home/logo.png" alt="">
            <h5>温州市鹿城区行政事业单位存量房产管理系统</h5>
        </div>
        <ul id="loginOk" class="ysh-XTList ">
            <li><a href="javascript:;">退出系统</a></li>
            <li><a href="javascript:;">消息<span class="xtInfo"></span></a></li>
            <li><span class="xiUser"></span>，欢迎使用本系统！</li>
        </ul>
    </div>
</header>
<div class="container">
    <div class="sidebar">
        <ul class="wzlc-menuList">
            <li>
                <a  href="../main.html">主页</a>
            </li>
            <li>
                <a class="houseInfo" href="../houseInfo.html">房屋信息</a>
            </li>
            <li>
                <a class="groupMgr" href="../groupMgr.html">分组管理</a>
            </li>
            <li>
                <a class="evaluateUnit" href="../evaluateUnit.html">评估单位</a>
            </li>
            <li class="Apply">
                <a class="applyMgr" href="javascript:;">出租管理</a>
                <ul class="applyList">
                    <li><a class="houseBp" href="houseBp.html">报批</a></li>
                    <li><a class="housePg" href="housePg.html">评估</a></li>
                    <li><a class="houseZz" href="houseZz.html">招租</a></li>
                    <li><a class="houseQy" href="houseQy.html">签约</a></li>
                    <li><a class="houseSz" href="houseSz.html">收租</a></li>
                    <li><a class="houseCz" href="houseCz.html">催租</a></li>
                    <li><a class="houseTz" href="houseTz.html">退租</a></li>
                    <li><a class="statics" href="statics.html">统计</a></li>
                    <li><a class="safeMgr" href="safeMgr.html">安全管理</a></li>
                    <li><a class="messageMgr" href="messageMgr.html">短信通知</a></li>
                </ul>
            </li>
            <li>
                <a class="sysMgr" href="javascript:;">系统设置</a>
            </li>
        </ul>
    </div>
    <div class="mainContent">
        <div class="infoHead">
            房屋收租
        </div>
        <div class="infoContent">
            <div class="table-container">
                <table class="table table-striped houseTable">
                    <thead>
                    <tr>
                    <th>序号</th>
                    <th>地址</th>
                    <th>面积</th>
                    <th>权属单位</th>
                    <th>房屋状态</th>
                    <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td colspan="7">正在加载数据，请稍后...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="houseSz" data-houseid="" tabindex="-1" role="dialog"  aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog" role="document" >
        <div class="modal-content" style="">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="houseModalLabel">房屋收租</h4>
            </div>
            <div class="modal-body" style="height: 550px;overflow-x: hidden;overflow-y: auto">
                <form class="form-horizontal houseForm" data-pid="">
                    <div class="form-group">
                        <label for="hStartTime" class="col-sm-3 control-label">缴租开始期限<span class="text-muted">*</span></label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control require" id="hStartTime">
                            <!--<input type="text" class="form-control" id="materialInDate" :duplex="@material_Info.NO">-->
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="hEndTime" class="col-sm-3 control-label">缴租结束期限<span class="text-muted">*</span></label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control require" id="hEndTime">
                            <!--<input type="text" class="form-control" id="materialInDate" :duplex="@material_Info.NO">-->
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="rentMoney" class="col-sm-3 control-label">租金<span class="text-muted">*</span></label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control require" id="rentMoney">
                            <!--<input type="text" class="form-control" id="materialInDate" :duplex="@material_Info.NO">-->
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="rentS" class="col-sm-3 control-label">房屋租赁税<span class="text-muted">*</span></label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control require" id="rentS">
                            <!--<input type="text" class="form-control" id="materialInDate" :duplex="@material_Info.NO">-->
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="sjcz" class="col-sm-3 control-label">上介财政<span class="text-muted">*</span></label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control require" id="sjcz">
                            <!--<input type="text" class="form-control" id="materialInDate" :duplex="@material_Info.NO">-->
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="remark" class="col-sm-3 control-label">备注内容<span class="text-muted">*</span></label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control require" id="remark">
                            <!--<input type="text" class="form-control" id="materialInDate" :duplex="@material_Info.NO">-->
                        </div>
                    </div>
                    <div class="form-group imgGroup">
                        <label class="col-sm-3 control-label">发票照片</label>
                        <div class="col-sm-9">
                            <input type="file" class="filesBtn file1" size="80" >
                            <!--<input type="text" class="form-control" id="materialInDate" :duplex="@material_Info.NO">-->
                        </div>
                        <div class="img-cont">
                            <ul id="img1_List">

                            </ul>
                        </div>
                    </div>
                    <div class="form-group imgGroup">
                        <label class="col-sm-3 control-label">非税收入缴款书照片</label>
                        <div class="col-sm-9">
                            <input type="file" class="filesBtn file2" size="80" >
                            <!--<input type="text" class="form-control" id="materialInDate" :duplex="@material_Info.NO">-->
                        </div>
                        <div class="img-cont">
                            <ul id="img2_List">

                            </ul>
                        </div>
                    </div>
                    <div class="form-group imgGroup">
                        <label class="col-sm-3 control-label">税单照片</label>
                        <div class="col-sm-9">
                            <input type="file" class="filesBtn file3" size="80" >
                            <!--<input type="text" class="form-control" id="materialInDate" :duplex="@material_Info.NO">-->
                        </div>
                        <div class="img-cont">
                            <ul id="img3_List">

                            </ul>
                        </div>
                    </div>
                    <div class="form-group imgGroup">
                        <label class="col-sm-3 control-label">保证金</label>
                        <div class="col-sm-9">
                            <input type="file" class="filesBtn file4" size="80" >
                            <!--<input type="text" class="form-control" id="materialInDate" :duplex="@material_Info.NO">-->
                        </div>
                        <div class="img-cont">
                            <ul id="img4_List">

                            </ul>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="subAddHouse">确定</button>
                <!--<button type="button" class="btn btn-primary" id="subEditHouse">确定</button>-->
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
<script src="../../js/jquery-2.1.4.min.js"></script>
<script src="../../bootstrap/js/bootstrap.min.js"></script>
<script src="../../plugins/daterangepicker/moment.min.js"></script>
<script src="../../plugins/daterangepicker/daterangepicker.js"></script>
<script src="../../plugins/jquery/alert/js/xcConfirm.js"></script>
<script src="../../plugins/toastr/toastr.min.js"></script>
<script src="../../js/global.js"></script>
<script>
    (function ($) {
        var   date = new Date(),today,check=true,id='1',houseId,leaseId;
        today = date.getFullYear()+'-'+(date.getMonth()+1)+'-'+date.getDate();
        var baseURL = window.global.requestURL,groupid,groupId,peopleId,arr1=[],arr2=[],arr3=[],arr4=[],arrLgt='0',
                uploadURL = window.global.uploadURL,photo1=[],photo2=[],photo3=[],photo4=[],allFiles=[];
        var mainHeight = (window.innerHeight - 70)+'px';
        var infoHgt = (window.innerHeight - 130)+'px';
        $('.container,.mainContent').innerHeight(mainHeight);
        $('.infoContent').innerHeight(infoHgt);
        $(window).resize(function(){
            mainHeight = (window.innerHeight - 70)+'px';
            infoHgt = (window.innerHeight - 130)+'px';
            $('.container,.mainContent').innerHeight(mainHeight);
            $('.infoContent').innerHeight(infoHgt);
        });
        //获取本地存储值
        if(window.sessionStorage.getItem('peopleName')){
            $('.xiUser').text(window.sessionStorage.getItem('peopleName'));
        }
        peopleId = window.sessionStorage.getItem('peopleId');
        groupid = window.sessionStorage.getItem('groupId')
        if(groupid =='170725144059'){
            groupId = window.sessionStorage.getItem('rootGroupid')
        }else{
            groupId = window.sessionStorage.getItem('groupId');
        }
        $('#hStartTime,#hEndTime').daterangepicker({
            locale: {
                format : 'YYYY-MM-DD',
                separator: ' ~ ',
                weekLabel: '星期',
            },
            startDate:today,
            singleDatePicker:true,
            timePicker:true,
            timePicker24Hour:true
        });
        var d= {
            msgid:'WZRPWHouseLise',
            msgbody:[
                {
                    groupid:groupId,
                    stage:'6'//报批状态值
                }
            ]
        };
        d = JSON.stringify(d);
        console.log(d);
        $.ajax({
            type:"post",
            url:baseURL,
            async:true,
            data:d,
            dataType:'json',
            success:function(data){
                console.log(data.resultcode)
                if(data.resultcode == '0'){
                    $('.houseTable>tbody').empty();
                    if(data.msgbody.length){
                        $.each(data.msgbody,function(i,o){
                            if(o.housestate =='1'){
                                o.housestate = '在租'
                            }else if(o.housestate =='2'){
                                o.housestate = '空置'
                            }else if(o.housestate =='3'){
                                o.housestate = '自用'
                            }else if(o.housestate =='4'){
                                o.housestate = '调配'
                            }else if(o.housestate =='5'){
                                o.housestate = '移交'
                            }else if(o.housestate =='6'){
                                o.housestate = '已拆除'
                            }else if(o.housestate =='7'){
                                o.housestate = '其他'
                            }
                            var li ='<tr><td>'+(i+1)+'</td><td>'+o.houseaddress+'</td><td>'+o.acreage+'m²</td>' +
                                '<td>'+o.groupname+'</td><td>'+o.housestate+'</td><td><button data-houseid="'+o.houseid+'" class="btn btn-primary bpBtn">收租</button></td></tr>';
                            $('.houseTable>tbody').append(li);
                            $('.bpBtn').unbind().on('click',seeBp);
                        });
                    }else{
                        $('.houseTable>tbody').append('<tr><td colspan="7">暂无数据</td></tr>');
                    }


                }
            }
        });
        //绑定事件
        $('.houseInfo').on('click',jumpHouseInfo);
        $('.groupMgr').on('click',jumpGroup);
        $('.evaluateUnit').on('click',jumpEvaluate);
        $('.applyMgr').on('click',toggleCon);
        $('.filesBtn').unbind().on('change',PreviewImage);
        $('#subAddHouse').on('click',subAddHouseBtn)
        //事件函数
        function seeBp() {
            houseId = $(this).attr('data-houseid');
            $('#houseSz input').val('');
            $('#houseSz').modal('show');
            if(groupId =='170725144059'){
                $('.filesBtn').attr('disabled','disabled');
                $('#subAddHouse').css('display','none')
            }
            var d ={
                msgid:'WZRPWBPInfo',
                msgbody:[
                    {
                        houseid:houseId,
                        stage:'6'
                    }
                ]
            };
            d = JSON.stringify(d);
            console.log(d)
            $.ajax({
                type: "post",
                url: baseURL,
                async: true,
                data: d,
                dataType:'json',
                success: function (data) {
                    leaseId = data.msgbody[0].leaseid;
                    if(data.msgbody[0].lstarttime!='1900-01-01 00:00:00'){
                        $('#hStartTime').val(data.msgbody[0].lstarttime).attr('disabled','disabled');
                    }
                    if(data.msgbody[0].lendtime!='1900-01-01 00:00:00'){
                        $('#hEndTime').val(data.msgbody[0].lstarttime).attr('disabled','disabled');
                    }
                    if(data.msgbody[0].paidinfinance){
                        $('#sjcz').val(data.msgbody[0].paidinfinance).attr('disabled','disabled');
                    }
                    if(data.msgbody[0].rental){
                        $('#rentMoney').val(data.msgbody[0].rental).attr('disabled','disabled');
                    }
                    if(data.msgbody[0].rentaltax){
                        $('#rentS').val(data.msgbody[0].rentaltax).attr('disabled','disabled');
                    }
                    if(data.msgbody[0].remark){
                        $('#remark').val(data.msgbody[0].remark).attr('disabled','disabled');
                    }
//                    if(data.msgbody[0].aunitname){
//                        $('#seeSelUnit').val(data.msgbody[0].aunitname).attr('disabled','disabled');
//                        $('#seeSelUnit').removeClass('ysh-disappear');
//                        $('#selUnit').addClass('ysh-disappear')
//                    }
                    if(data.msgbody[0].photoList.length){
                        $('.filesBtn').attr('disabled','disabled');
                        $('#subAddHouse').css('display','none');
                        $('#imgsList').empty();
                        $('#subAddHouse').css('display','none');
                        $('.spbFiles').attr('disabled','disabled');
                        $.each(data.msgbody[0].photoList,function (i,o) {
                            if(o.pkid=='9af23120-8df1-11e7-9a80-fa163e437026'){
                                var li = '<li><div id="' + id + '"><img src="' + o.photourl + '" alt=""></div><div class="form-group"><label for="" class="col-sm-3 control-label">备注</label>' +
                                        '<div class="col-sm-9"><input type="text" class="form-control require Rmk1" value="' + o.remark + '" id=""></div>' +
                                        '</div></li>';
                                $('#img1_List').append(li);
                            }else if(o.pkid=='b696528d-8df1-11e7-9a80-fa163e437026'){
                                var li = '<li><div id="' + id + '"><img src="' + o.photourl + '" alt=""></div><div class="form-group"><label for="" class="col-sm-3 control-label">备注</label>' +
                                        '<div class="col-sm-9"><input type="text" class="form-control require Rmk2" value="' + o.remark + '" id=""></div>' +
                                        '</div></li>';
                                $('#img2_List').append(li);
                            }else if(o.pkid=='c3fad8d6-8df1-11e7-9a80-fa163e437026'){
                                var li = '<li><div id="' + id + '"><img src="' + o.photourl + '" alt=""></div><div class="form-group"><label for="" class="col-sm-3 control-label">备注</label>' +
                                        '<div class="col-sm-9"><input type="text" class="form-control require Rmk3" value="' + o.remark + '" id=""></div>' +
                                        '</div></li>';
                                $('#img3_List').append(li);
                            }else if(o.pkid=='d6b2c84e-8df1-11e7-9a80-fa163e437026'){
                                var li = '<li><div id="' + id + '"><img src="' + o.photourl + '" alt=""></div><div class="form-group"><label for="" class="col-sm-3 control-label">备注</label>' +
                                        '<div class="col-sm-9"><input type="text" class="form-control require Rmk4" value="' + o.remark + '" id=""></div>' +
                                        '</div></li>';
                                $('#img4_List').append(li);
                            }

                        });
                    }
                }
            });
        }
        function subAddHouseBtn() {
            arrLgt = arr1.length+arr2.length+arr3.length+arr4.length;
            console.log(arrLgt);
            $.each($('.houseForm .require'),function (i,o) {
                if(!$(o)[0].value || $(o)[0].value.trim( )== ''){
                    var label = $(o).parent().siblings().text().slice(0,-1);
//                    mui.toast(label.innerText + "不允许为空");
                    window.wxc.xcConfirm(label + "不允许为空",window.wxc.xcConfirm.typeEnum.warning);
                    check = false;
                    return false;
                }
            });
            console.log(check);
            if(arrLgt) {
                $.each(arr1, function (i, o) {
                    var obj = {
                        files: o,
                        remark: '',
                        isLocal: true,
                        fileType: 'jpg',
                        name:'发票照片',
                        usetype:'9af23120-8df1-11e7-9a80-fa163e437026',
                    };
                    photo1.push(obj);
                });
                $.each(arr2, function (i, o) {
                    var obj = {
                        files: o,
                        remark: '',
                        isLocal: true,
                        fileType: 'jpg',
                        name:'非税收入缴款书照片',
                        usetype:'b696528d-8df1-11e7-9a80-fa163e437026',
                    };
                    photo2.push(obj);
                });
                $.each(arr3, function (i, o) {
                    var obj = {
                        files: o,
                        remark: '',
                        isLocal: true,
                        fileType: 'jpg',
                        name:'税单照片',
                        usetype:'c3fad8d6-8df1-11e7-9a80-fa163e437026',
                    };
                    photo3.push(obj);
                });
                $.each(arr4, function (i, o) {
                    var obj = {
                        files: o,
                        remark: '',
                        isLocal: true,
                        fileType: 'jpg',
                        name:'保证金收据照片',
                        usetype:'d6b2c84e-8df1-11e7-9a80-fa163e437026',
                    };
                    photo4.push(obj);
                });
                $.each($('.Rmk1'), function (i, o) {
                    console.log($(o).val());
                    var j = $(o).val();
                    photo1[i].remark = j;
                });
                $.each($('.Rmk2'), function (i, o) {
                    console.log($(o).val());
//                    var j2 = $(o).val();
                    photo2[i].remark = $(o).val();
                });
                $.each($('.Rmk3'), function (i, o) {
                    console.log($(o).val());
                    var j = $(o).val();
                    photo3[i].remark = $(o).val();
                });
                $.each($('.Rmk4'), function (i, o) {
                    console.log($(o).val());
                    var j = $(o).val();
                    photo4[i].remark = j;
                });
                $.each(photo1, function (i, o) {
                    allFiles.push(o);
                });
                $.each(photo2, function (i, o) {
                    allFiles.push(o);
                });
                $.each(photo3, function (i, o) {
                    allFiles.push(o);
                });
                $.each(photo4, function (i, o) {
                    allFiles.push(o);
                });
                console.log(photo1);
                console.log(leaseId);
                console.log(allFiles);
            }

            if(check){
                console.log( $('#hStartTime').val())
                console.log( $('#hEndTime').val())
                console.log( $('#rentMoney').val())
                console.log( $('#rentS').val())
                console.log( $('#sjcz').val())
                console.log( $('#remark').val())
                var d = {
                    msgid: 'WZRPWAddRent',
                    msgbody: [{
                        leaseid: leaseId,
                        houseid: houseId,
                        lstarttime: $('#hStartTime').val(),
                        lendtime: $('#hEndTime').val(),
                        rental: $('#rentMoney').val(),
                        rentaltax: $('#rentS').val(),
                        paidinfinance: $('#sjcz').val(),
                        remark: $('#remark').val(),
                    }]
                };
                d = JSON.stringify(d);
                console.log(d)
                $.ajax({
                    type: "post",
                    url: baseURL,
                    async: true,
                    data: d,
                    dataType:'json',
                    success: function(data) {
                        if(data.resultcode == '0') {

                            if(arrLgt){
                                uploadFiles(allFiles);
                                drawTable();
                            }else{
                                toastr.success('操作成功')
                                drawTable();
                            }
                        }
                    }
                });
            }
        }
        function uploadFiles(arr) {
            var photo = arr;
            $.each(photo, function (i, o) {
                var usetype = o.usetype;
                var formdata = new FormData();
                var rmk = o.remark;
                formdata.append('file', o.files[0]);
                var queryString = '?linkid=' + leaseId + '&pkid=' + usetype + '&remark=' + rmk + '&peopleid=' + peopleId;
                // 上传附件
                $.ajax({
                    url: uploadURL + queryString, type: 'POST',
                    data: formdata,
                    processData: false,
                    contentType: false,
                    dataType: 'json',
                    success: function (data) {
                        arrLgt--;
                        if (!arrLgt) {
                            toastr.success('操作成功！');
                            drawTable();
                            $('#houseModal').modal('hide');
                        }
                    }
                });
            });
        }
        function PreviewImage() {
            var imgFile = this;
            console.log($(this).attr('class'))
            var pattern = /(\.*.jpg$)|(\.*.png$)|(\.*.jpeg$)|(\.*.gif$)|(\.*.bmp$)/;
            if(!pattern.test(imgFile.value)) {
                alert("系统仅支持jpg/jpeg/png/gif/bmp格式的照片！");
                imgFile.focus();
            }else{
                //定义图片路径
                var path;
                //添加显示图片的HTML元素
                id += 1;
                if($(this).hasClass('file1')){
                    arr1.push($(this)[0].files);
                    var li = '<li><div id="'+id+'"><img src="" alt=""></div><div class="form-group"><label for="" class="col-sm-3 control-label">备注</label>' +
                            '<div class="col-sm-9"><input type="text" class="form-control require Rmk1" id=""></div>' +
                            '</div> <a class="hide delete-btn"  data-flag="false">删除</a></li>';
                    $('#img1_List').append(li);
                }else if($(this).hasClass('file2')){
                    arr2.push($(this)[0].files);
                    var li = '<li><div id="'+id+'"><img src="" alt=""></div><div class="form-group"><label for="" class="col-sm-3 control-label">备注</label>' +
                            '<div class="col-sm-9"><input type="text" class="form-control require Rmk2" id=""></div>' +
                            '</div> <a class="hide delete-btn"  data-flag="false">删除</a></li>';
                    $('#img2_List').append(li);
                }else if($(this).hasClass('file3')){
                    arr3.push($(this)[0].files);
                    var li = '<li><div id="'+id+'"><img src="" alt=""></div><div class="form-group"><label for="" class="col-sm-3 control-label">备注</label>' +
                            '<div class="col-sm-9"><input type="text" class="form-control require Rmk3" id=""></div>' +
                            '</div> <a class="hide delete-btn"  data-flag="false">删除</a></li>';
                    $('#img3_List').append(li);
                }else if($(this).hasClass('file4')){
                    arr4.push($(this)[0].files);
                    var li = '<li><div id="'+id+'"><img src="" alt=""></div><div class="form-group"><label for="" class="col-sm-3 control-label">备注</label>' +
                            '<div class="col-sm-9"><input type="text" class="form-control require Rmk4" id=""></div>' +
                            '</div> <a class="hide delete-btn"  data-flag="false">删除</a></li>';
                    $('#img4_List').append(li);
                }
                console.log(arr1);
//                $(".img-cont").append("<li><div id='"+id+"'><img src='' /></div><div><p>备注</p></div><a class='hide delete-btn'>删除</a></li>");
                //判断浏览器类型
                if(document.all){
                    //兼容IE
                    imgFile.select();
                    path = document.selection.createRange().text;
                    document.getElementById(id).innerHTML="";
                    document.getElementById(id).style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled='true',sizingMethod='scale',src=\"" + path + "\")";//使用滤镜效果
                }else{
                    //兼容其他浏览器
                    path = URL.createObjectURL(imgFile.files[0]);
                    document.getElementById(id).innerHTML = "<img src='"+path+"' width='210' height='160' />";
                }
                console.log(path)
                //重置表单
//                resetForm(imgFile);
            }
        }

//重置表单,允许用户连续添加相同的图片
        function resetForm(imgFile){
            $(imgFile).parents('.houseForm')[0].reset();
        }

//控制"按钮"显示与隐藏
        $(".img-cont").off("mouseenter","div").on("mouseenter","li",function(){
            var that=this;
            var dom=$(that).children("a");
            dom.removeClass("hide");
            //为点击事件解绑，防止重复执行
            dom.off("click");
            console.log($(dom).attr('data-flag'))
            if($(dom).attr('data-flag') == 'true'){
                dom.on("click",function(){
                    var pid  = $(dom).attr('data-pid');
                    console.log(pid)
                    var d  = {
                        msgid:'WZRPMDelPhoto',
                        msgbody:[{
                            photoid:pid
                        }]
                    };
                    d = JSON.stringify(d);
                    console.log(d)
//                    $.ajax({
//                        type:"post",
//                        url:baseURL,
//                        async:true,
//                        data:d,
//                        dataType:'json',
//                        success:function(data){
//                            if(data.resultcode =='0'){
//                                //删除当前图片
//                    dom.parent().remove();
////							mui.back()
//                            }
//                        }
//                    });

                });

            }else{
                dom.on("click",function(){
                    //删除当前图片
                    dom.parent().remove();
                });
            }

        }).off("mouseleave","div").on("mouseleave","li",function(){
            var that=this;
            $(that).children("a").addClass("hide");
        })
        function drawTable() {
            var d= {
                msgid:'WZRPWHouseLise',
                msgbody:[
                    {
                        groupid:groupId,
                        stage:'6'//报批状态值
                    }
                ]
            };
            d = JSON.stringify(d);
            console.log(d);
            $.ajax({
                type:"post",
                url:baseURL,
                async:true,
                data:d,
                dataType:'json',
                success:function(data){
                    console.log(data.resultcode)
                    if(data.resultcode == '0'){
                        $('.houseTable>tbody').empty();
                        if(data.msgbody.length){
                            $.each(data.msgbody,function(i,o){
                                if(o.housestate =='1'){
                                    o.housestate = '在租'
                                }else if(o.housestate =='2'){
                                    o.housestate = '空置'
                                }else if(o.housestate =='3'){
                                    o.housestate = '自用'
                                }else if(o.housestate =='4'){
                                    o.housestate = '调配'
                                }else if(o.housestate =='5'){
                                    o.housestate = '移交'
                                }else if(o.housestate =='6'){
                                    o.housestate = '已拆除'
                                }else if(o.housestate =='7'){
                                    o.housestate = '其他'
                                }
                                var li ='<tr><td>'+(i+1)+'</td><td>'+o.houseaddress+'</td><td>'+o.acreage+'m²</td>' +
                                        '<td>'+o.groupname+'</td><td>'+o.housestate+'</td><td><button data-houseid="'+o.houseid+'" class="btn btn-primary bpBtn">收租</button></td></tr>';
                                $('.houseTable>tbody').append(li);
                                $('.bpBtn').unbind().on('click',seeBp);
                            });
                        }else{
                            $('.houseTable>tbody').append('<tr><td colspan="7">暂无数据</td></tr>');
                        }


                    }
                }
            });
        }
        function toggleCon() {
            if($('.applyList').hasClass('ysh-disappear')){
                $('.Apply').css('height','462px');
                $('.applyList').removeClass('ysh-disappear');
            }else{
                $('.applyList').addClass('ysh-disappear');
                $('.Apply').css('height','60px');
            }
        }
        function jumpHouseInfo() {
            window.location.href='houseInfo.html'
        }
        function jumpGroup() {
            if(groupid == '170725144059'){
                window.location.href='groupMgr.html'
            }else{
                window.wxc.xcConfirm('您不具备此操作权限', window.wxc.xcConfirm.typeEnum.warning);
            }
        }
        function jumpEvaluate() {
            if(groupid == '170725144059'){
                window.location.href='evaluateUnit.html'
            }else{
                window.wxc.xcConfirm('您不具备此操作权限', window.wxc.xcConfirm.typeEnum.warning);
            }
        }
    })(window.jQuery)
</script>
</body>
</html>