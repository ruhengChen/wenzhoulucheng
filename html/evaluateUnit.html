<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>温州鹿城房产管理系统</title>
    <link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../plugins/jquery/alert/css/xcConfirm.css">
    <link rel="stylesheet" href="../plugins/toastr/toastr.min.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/common.css">
    <style>
        .unitTable>thead th,.unitTable tbody td{
            text-align: center;
        }
        .table-striped>tbody>tr.table-selected{
            background-color: #059C7E;
        }
        .text-muted{
            color: #ff0000;
        }
    </style>
</head>
<body>
<header>
    <div  class="ysh-wzlcHead">
        <div class="ysh-wzlcTitle">
            <img class="wzlcLogo" src="../images/home/logo.png" alt="">
            <h5>温州市鹿城区行政事业单位存量房产管理系统</h5>
        </div>
        <ul id="loginOk" class="ysh-XTList ">
            <li><a href="javascript:;">退出系统</a></li>
            <li><a href="javascript:;">消息<span class="xtInfo"></span></a></li>
            <li><span class="xiUser"></span>，欢迎使用本系统！</li>
        </ul>
    </div>
</header>
<div class="container">
    <div class="sidebar">
        <ul class="wzlc-menuList">
            <li>
                <a  href="main.html">主页</a>
            </li>
            <li>
                <a class="houseInfo" href="houseInfo.html">房屋信息</a>
            </li>
            <li>
                <a class="groupMgr" href="groupMgr.html">分组管理</a>
            </li>
            <li>
                <a class="evaluateUnit" href="evaluateUnit.html">评估单位</a>
            </li>
            <li class="Apply">
                <a class="applyMgr" href="javascript:;">出租管理</a>
                <ul class="applyList ysh-disappear">
                    <li><a class="houseBp" href="apply/houseBp.html">报批</a></li>
                    <li><a class="housePg" href="apply/housePg.html">评估</a></li>
                    <li><a class="houseZz" href="apply/houseZz.html">招租</a></li>
                    <li><a class="houseQy" href="apply/houseQy.html">签约</a></li>
                    <li><a class="houseSz" href="apply/houseSz.html">收租</a></li>
                    <li><a class="houseCz" href="apply/houseCz.html">催租</a></li>
                    <li><a class="houseTz" href="apply/houseTz.html">退租</a></li>
                    <li><a class="statics" href="apply/statics.html">统计</a></li>
                    <li><a class="safeMgr" href="apply/safeMgr.html">安全管理</a></li>
                    <li><a class="messageMgr" href="apply/messageMgr.html">短信通知</a></li>
                </ul>
            </li>
            <li>
                <a class="sysMgr" href="javascript:;">系统设置</a>
            </li>
        </ul>
    </div>
    <div class="mainContent">
        <div class="infoHead">
            评估单位
        </div>
        <div class="infoContent">
            <div class="tableToolBar">
                <button class="btn btn-default addEvaluate">新增</button>
                <button class="btn btn-default editEvaluate">编辑</button>
                <button class="btn btn-default delEvaluate">删除</button>
                <button class="btn btn-default seeEvaluate">查看</button>
            </div>
            <div class="table-container">
                <table class="table table-striped unitTable">
                    <thead>
                    <tr>
                    <th>序号</th>
                    <th>单位名称</th>
                    <th>联系人</th>
                    <th>联系电话</th>
                    <th>联系手机</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td colspan="6">正在加载数据...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<!--新增修改评估单位模态框-->
<div class="modal fade" id="evaluateUnitModal" data-unitid="" tabindex="-1" role="dialog"  aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog" role="document" >
        <div class="modal-content" style="width:800px;height: 670px">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="evaluateUnitModalLabel"></h4>
            </div>
            <div class="modal-body" style="height: 550px;overflow-x: hidden;overflow-y: auto">
                <form class="form-horizontal houseForm" data-unitid="">
                    <div class="form-group">
                        <label for="unitName" class="col-sm-3 control-label">单位名称<span class="text-muted">*</span></label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control require" id="unitName" >
                            <!--<input type="text" class="form-control" id="materialInDate" :duplex="@material_Info.NO">-->
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="linkMan" class="col-sm-3 control-label">联系人<span class="text-muted">*</span></label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control require" id="linkMan" >
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="linkTel" class="col-sm-3 control-label">联系电话<span class="text-muted">*</span></label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control require" id="linkTel" >
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="linkPhone" class="col-sm-3 control-label">联系手机<span class="text-muted">*</span></label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control require" id="linkPhone" >
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="scale100" class="col-sm-3 control-label">100方是收费标准<span class="text-muted">*</span></label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control require" id="scale100" >
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="scale300" class="col-sm-3 control-label">300方是收费标准<span class="text-muted">*</span></label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control require" id="scale300" >
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="scale500" class="col-sm-3 control-label">500方是收费标准<span class="text-muted">*</span></label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control require" id="scale500" >
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="scale1000" class="col-sm-3 control-label">1000方是收费标准<span class="text-muted">*</span></label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control require" id="scale1000" >
                        </div>
                    </div><div class="form-group">
                    <label for="scale2000" class="col-sm-3 control-label">2000方是收费标准<span class="text-muted">*</span></label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control require" id="scale2000" >
                    </div>
                </div><div class="form-group">
                    <label for="scale3000" class="col-sm-3 control-label">100方是收费标准<span class="text-muted">*</span></label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control require" id="scale3000" >
                    </div>
                </div><div class="form-group">
                    <label for="scale3001" class="col-sm-3 control-label">3001方是收费标准<span class="text-muted">*</span></label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control require" id="scale3001" >
                    </div>
                </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="subAddEvaluate">确定</button>
                <button type="button" class="btn btn-primary" id="subEditEvaluate">确定</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
<script src="../js/jquery-2.1.4.min.js"></script>
<script src="../bootstrap/js/bootstrap.min.js"></script>
<script src="../plugins/jquery/alert/js/xcConfirm.js"></script>
<script src="../plugins/toastr/toastr.min.js"></script>
<script src="../js/global.js"></script>
<script>
    (function ($) {
        var baseURL = window.global.requestURL,check=true,groupid,groupId,peopleId;
        var mainHeight = (window.innerHeight - 70)+'px';
        var infoHgt = (window.innerHeight - 130)+'px';
        $('.container,.mainContent').innerHeight(mainHeight);
        $('.infoContent').innerHeight(infoHgt);
        $(window).resize(function(){
            mainHeight = (window.innerHeight - 70)+'px';
            infoHgt = (window.innerHeight - 130)+'px';
            $('.container,.mainContent').innerHeight(mainHeight);
            $('.infoContent').innerHeight(infoHgt);
        });
        //获取本地存储值
        if(window.sessionStorage.getItem('peopleName')){
            $('.xiUser').text(window.sessionStorage.getItem('peopleName'));
        }
        peopleId = window.sessionStorage.getItem('peopleId');
        groupid = window.sessionStorage.getItem('groupId')
        if(groupid =='170725144059'){
            groupId = window.sessionStorage.getItem('rootGroupid')
        }else{
            $('.editHouse').css('display','none')
            groupId = window.sessionStorage.getItem('groupId');
        }

        var d ={
            msgid:'WZRPMAssessmentFind',
            msgbody:[{

            }]
        };
        d  = JSON.stringify(d)
        $.ajax({
            type:"post",
            url:baseURL,
            async:true,
            data:d,
            dataType:'json',
            success:function(data){
                console.log(data.resultcode);
                if(data.resultcode == '0'){
                    $('.unitTable tbody').empty();
                    if(data.msgbody.length){
                        $.each(data.msgbody,function(i,o){
                            var l ='<tr data-unitid="'+o.aunitid+'"><td>'+(i+1)+'</td><td>'+o.aunitname+'</td><td>'+o.aunitman+'</td>' +
                                    '<td>'+o.contactsPhone+'</td><td>'+o.contacts+'</td></tr>';
                            $('.unitTable tbody').append(l);
                        });
                        $('.unitTable tbody td').unbind().on('click',function () {
                            $(this).parent().addClass('table-selected');
                            $(this).parent().siblings().removeClass('table-selected');
                        });
                    }else{
                        $('.unitTable tbody').append('<tr><td colspan="6">暂无数据</td></tr>');
                    }

//							$('#ysh-houseList>li').unbind().on('tap',seeUnitInfo)
                }
            }
        });
        //绑定事件
        $('.houseInfo').on('click',jumpHouseInfo);
        $('.groupMgr').on('click',jumpGroup);
        $('.evaluateUnit').on('click',jumpEvaluate);
        $('.applyMgr').on('click',toggleCon);
        $('.addEvaluate').on('click',addEvaluateBtn);
        $('.editEvaluate').on('click',editEvaluateBtn);
        $('.delEvaluate').on('click',delEvaluateBtn);
        $('.seeEvaluate').on('click',seeEvaluateBtn);
        $('#subAddEvaluate').on('click',subAddEvaluateBtn)
        $('#subEditEvaluate').on('click',subEditEvaluateBtn);
        //事件函数
        function toggleCon() {
            if($('.applyList').hasClass('ysh-disappear')){
                $('.Apply').css('height','462px');
                $('.applyList').removeClass('ysh-disappear');
            }else{
                $('.applyList').addClass('ysh-disappear');
                $('.Apply').css('height','60px');
            }
        }
        function addEvaluateBtn() {
            $('#evaluateUnitModal input').removeAttr('disabled');
            $('#evaluateUnitModal input').val('');
            $('#subAddEvaluate').css('display','inline-block');
            $('#subEditEvaluate').css('display','none');
            $('#evaluateUnitModalLabel').text('增加评估单位');
            $('#evaluateUnitModal').modal('show');
        }
        function editEvaluateBtn() {
            var unitid = $('.unitTable tbody>tr.table-selected').attr('data-unitid');
            if(unitid){
                $('#evaluateUnitModal input').removeAttr('disabled');
                var d ={
                    msgid:'WZRPMAssessmentFind',
                    msgbody:[{

                    }]
                };
                d  = JSON.stringify(d)
                $.ajax({
                    type:"post",
                    url:baseURL,
                    async:true,
                    data:d,
                    dataType:'json',
                    success:function(data){
                        console.log(data.resultcode);
                        if(data.resultcode == '0'){
                            $.each(data.msgbody,function (i,o) {
                                if(o.aunitid == unitid){
                                    $('#evaluateUnitModal').attr('data-unitid',o.aunitid);
                                    $('#unitName').val(o.aunitname);
                                    $('#linkMan').val(o.aunitman);
                                    $('#linkTel').val(o.contacts);
                                    $('#linkPhone').val(o.contactsPhone);
                                    $('#scale100').val(o.feeScale100);
                                    $('#scale300').val(o.feeScale300);
                                    $('#scale500').val(o.feeScale500);
                                    $('#scale1000').val(o.feeScale1000);
                                    $('#scale2000').val(o.feeScale2000);
                                    $('#scale3000').val(o.feeScale3000);
                                    $('#scale3001').val(o.feeScale3001);
                                }
                            });
                            $('#subAddEvaluate').css('display','none');
                            $('#subEditEvaluate').css('display','inline-block');
                            $('#evaluateUnitModalLabel').text('修改评估单位')
                            $('#evaluateUnitModal').modal('show')
//                            $('.unitTable tbody').empty();
//                            if(data.msgbody.length){
//                                $.each(data.msgbody,function(i,o){
//                                    var l ='<tr data-unitid="'+o.aunitid+'"><td>'+(i+1)+'</td><td>'+o.aunitname+'</td><td>'+o.aunitman+'</td>' +
//                                            '<td>'+o.contactsPhone+'</td><td>'+o.contacts+'</td></tr>';
//                                    $('.unitTable tbody').append(l);
//                                });
//                                $('.unitTable tbody td').unbind().on('click',function () {
//                                    $(this).parent().addClass('table-selected');
//                                    $(this).parent().siblings().removeClass('table-selected');
//                                });
//                            }else{
//                                $('.unitTable tbody').append('<tr><td colspan="6">暂无数据</td></tr>');
//                            }

//							$('#ysh-houseList>li').unbind().on('tap',seeUnitInfo)
                        }
                    }
                });
            }else {
                window.wxc.xcConfirm( "请选择单位！",window.wxc.xcConfirm.typeEnum.warning);
            }
        }
        function delEvaluateBtn() {
            var unitid = $('.unitTable tbody>tr.table-selected').attr('data-unitid');
            if(unitid){
                window.wxc.xcConfirm( "确认删除该单位！",window.wxc.xcConfirm.typeEnum.warning,{
                    onOk:function () {
                        var d ={
                            msgid:'WZRPMDelAssessment',
                            msgbody:[{
                                aunitid:unitid
                            }]
                        };
                        d  = JSON.stringify(d)
                        $.ajax({
                            type:"post",
                            url:baseURL,
                            async:true,
                            data:d,
                            dataType:'json',
                            success:function(data){

                                if(!data.code){
                                   toastr.success('删除成功');
                                    drawTable();
                                }
                            }
                        });
                    }
                });
            }else{
                window.wxc.xcConfirm( "请选择单位！",window.wxc.xcConfirm.typeEnum.warning);
            }
        }
        function seeEvaluateBtn() {
            var unitid = $('.unitTable tbody>tr.table-selected').attr('data-unitid');
            if(unitid){
                var d ={
                    msgid:'WZRPMAssessmentFind',
                    msgbody:[{

                    }]
                };
                d  = JSON.stringify(d)
                $.ajax({
                    type:"post",
                    url:baseURL,
                    async:true,
                    data:d,
                    dataType:'json',
                    success:function(data){
                        console.log(data.resultcode);
                        if(data.resultcode == '0'){
                            $.each(data.msgbody,function (i,o) {
                                if(o.aunitid == unitid){
                                    $('#evaluateUnitModal').attr('data-unitid',o.aunitid);
                                    $('#unitName').val(o.aunitname);
                                    $('#linkMan').val(o.aunitman);
                                    $('#linkTel').val(o.contacts);
                                    $('#linkPhone').val(o.contactsPhone);
                                    $('#scale100').val(o.feeScale100);
                                    $('#scale300').val(o.feeScale300);
                                    $('#scale500').val(o.feeScale500);
                                    $('#scale1000').val(o.feeScale1000);
                                    $('#scale2000').val(o.feeScale2000);
                                    $('#scale3000').val(o.feeScale3000);
                                    $('#scale3001').val(o.feeScale3001);
                                }
                            });
                            $('#subAddEvaluate').css('display','none');
                            $('#subEditEvaluate').css('display','none');
                            $('#evaluateUnitModalLabel').text('查看评估单位');
                            $('#evaluateUnitModal input').attr('disabled','disabled');
                            $('#evaluateUnitModal').modal('show');

                        }
                    }
                });
            }else {
                window.wxc.xcConfirm( "请选择单位！",window.wxc.xcConfirm.typeEnum.warning);
            }
        }
        function subAddEvaluateBtn() {
            $.each($('.houseForm .require'),function (i,o) {
                if(!$(o)[0].value || $(o)[0].value.trim( )== ''){
                    var label = $(o).parent().siblings().text().slice(0,-1);
//                    mui.toast(label.innerText + "不允许为空");
                    window.wxc.xcConfirm(label + "不允许为空",window.wxc.xcConfirm.typeEnum.warning);
                    check = false;
                    return false;
                }
            });
                if(check){
                    var d  = {
                        msgid:'WZRPMAddAssessment',
                        msgbody:[
                            {
                                aunitname:$('#UNITNAME').val(),
                                aunitman:$('#linkMan').val(),
                                contacts:$('#linkTel').val(),
                                contactsPhone:$('#linkPhone').val(),
                                feeScale100:$('#scale100').val(),
                                feeScale300:$('#scale300').val(),
                                feeScale500:$('#scale500').val(),
                                feeScale1000:$('#scale1000').val(),
                                feeScale2000:$('#scale2000').val(),
                                feeScale3000:$('#scale3000').val(),
                                feeScale3001:$('#scale3001').val(),
                            }
                        ]
                    };
                    d = JSON.stringify(d);
                    console.log(d)
                    $.ajax({
                        url:baseURL,
                        type:'post',
                        data:d,
                        dataType:'json',
                        success:function(data){
                            console.log(data.resulecode);
                            if(data.resultcode == '0'){
                                drawTable();
                                $('#evaluateUnitModal').modal('hide');
                                toastr.success('操作成功');
                            }
                        }
                    })
                }
        }
        function subEditEvaluateBtn() {
            $.each($('.houseForm .require'),function (i,o) {
                if(!$(o)[0].value || $(o)[0].value.trim( )== ''){
                    var label = $(o).parent().siblings().text().slice(0,-1);
//                    mui.toast(label.innerText + "不允许为空");
                    window.wxc.xcConfirm(label + "不允许为空",window.wxc.xcConfirm.typeEnum.warning);
                    check = false;
                    return false;
                }
            });
            var unitId = $('#evaluateUnitModal').attr('data-unitid');
            if(check){
                console.log(unitId)
                var d  = {
                    msgid:'WZRPMEditAssessment',
                    msgbody:[
                        {
                            aunitid:unitId,
                            aunitname:$('#unitName').val(),
                            aunitman:$('#linkName').val(),
                            contacts:$('#contacts').val(),
                            contactsPhone:$('#contactsPhone').val(),
                            feeScale100:$('#scale100').val(),
                            feeScale300:$('#scale300').val(),
                            feeScale500:$('#scale500').val(),
                            feeScale1000:$('#scale1000').val(),
                            feeScale2000:$('#scale2000').val(),
                            feeScale3000:$('#scale3000').val(),
                            feeScale3001:$('#scale3001').val(),
                        }
                    ]
                };
                d = JSON.stringify(d);
                console.log(d)
                $.ajax({
                    url:baseURL,
                    type:'post',
                    data:d,
                    dataType:'json',
                    success:function(data){
//								console.log(data.resultcode);
                        if(data.resultcode == '0'){
                            drawTable();
                            $('#evaluateUnitModal').modal('hide');
                            toastr.success('操作成功');
                        }
                    }
                })
            }
        }
        function drawTable() {
            var d ={
                msgid:'WZRPMAssessmentFind',
                msgbody:[{

                }]
            };
            d  = JSON.stringify(d)
            $.ajax({
                type:"post",
                url:baseURL,
                async:true,
                data:d,
                dataType:'json',
                success:function(data){
                    console.log(data.resultcode);
                    if(data.resultcode == '0'){
                        $('.unitTable tbody').empty();
                        if(data.msgbody.length){
                            $.each(data.msgbody,function(i,o){
                                var l ='<tr data-unitid="'+o.aunitid+'"><td>'+(i+1)+'</td><td>'+o.aunitname+'</td><td>'+o.aunitman+'</td>' +
                                        '<td>'+o.contactsPhone+'</td><td>'+o.contacts+'</td></tr>';
                                $('.unitTable tbody').append(l);
                            });
                            $('.unitTable tbody td').unbind().on('click',function () {
                                $(this).parent().addClass('table-selected');
                                $(this).parent().siblings().removeClass('table-selected');
                            });
                        }else{
                            $('.unitTable tbody').append('<tr><td colspan="6">暂无数据</td></tr>');
                        }

//							$('#ysh-houseList>li').unbind().on('tap',seeUnitInfo)
                    }
                }
            });
        }
        function jumpHouseInfo() {
            window.location.href='houseInfo.html'
        }
        function jumpGroup() {
            if(groupid == '170725144059'){
                window.location.href='groupMgr.html'
            }else{
                window.wxc.xcConfirm('您不具备此操作权限', window.wxc.xcConfirm.typeEnum.warning);
            }
        }
        function jumpEvaluate() {
            if(groupid == '170725144059'){
                window.location.href='evaluateUnit.html'
            }else{
                window.wxc.xcConfirm('您不具备此操作权限', window.wxc.xcConfirm.typeEnum.warning);
            }
        }
    })(window.jQuery)
</script>
</body>
</html>