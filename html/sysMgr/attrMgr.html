<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>三门峡黄河公铁两用桥信息系统</title>
    <link rel="stylesheet" href="../../bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../plugins/daterangepicker/daterangepicker.css">
    <link rel="stylesheet" href="../../plugins/jquery/alert/css/xcConfirm.css">
    <link rel="stylesheet" href="../../css/base.css">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/userMgr.css">
    <style>
        .attrContainer{
            padding-left: 0;
        }
        #attrTable>thead th,#attrTable>tbody td{
            text-align: center;
        }
    </style>
</head>
<body>
<header class="ysh-smxHead">
    <div class="ysh-smxTitle">
        <img class="smxLogo" src="../../images/home/logo.png" alt="">
        <h5>三门峡黄河公铁两用桥信息系统</h5>
    </div>
    <!--<div id="btnLogin" class="ysh-XTList">-->
    <!--<button id="loginBtn" class="btn btn-login">登录</button>-->
    <!--</div>-->

    <ul id="loginOk" class="ysh-XTList ">
        <li><a href="javascript:;">退出系统</a></li>
        <li><a href="javascript:;">消息<span class="xtInfo"></span></a></li>
        <li><span class="xiUser"></span>，欢迎使用本系统！</li>
    </ul>
</header>
<div class="ysh-menu">
    <ul class="ysh-menuList">
        <li><a href="../main.html">首页</a></li>

        <li><a  href="../itemGK/itemIntro.html">工程概况</a></li>
        <li><a  href="../userMgr.html">人员管理</a></li>
        <li class="wsMgr">
            <a href="javascript:;">物设管理</a>
            <ul class="wsCont ysh-disappear">
                <li><a href="../wsMgr/equipment.html">机械设备</a></li>
                <li><a href="../wsMgr/materialMgr.html">材料设备</a></li>
            </ul>
        </li>
        <li>
            <a  href="javascript:;">进度管理</a>
            <ul class="jdCont ysh-disappear">
                <li><a href="../processMgr/itemUnit.html">项目单位</a></li>
                <li><a href="../processMgr/sgPlan.html">总施工进度</a></li>
            </ul>
        </li>
        <li>
            <a href="../safeMgr/safeUserMgr.html">安全管理</a>
        </li>
        <li>
            <a href="javascript:;">质量管理</a>
            <ul class="zlCont ysh-disappear">
                <li><a class="reportMgr" href="../zlMgr/reportMgr.html">检测报告</a></li>
            </ul>
        </li>
        <li><a href="javascript:;">风险管理</a></li>
        <li><a href="../jsMgr/datumMgr.html">技术管理</a></li>
        <li><a href="javascript:;">试验管理</a></li>
        <li><a href="javascript:;">视频监控</a></li>
        <li class="sysMgr">
            <a style=" background: rgb(0,133,106);"  href="javascript:;">系统管理</a>
            <ul class="sysCont ysh-disappear">
                <li><a class="attrMgr" href="attrMgr.html">属性管理</a></li>
                <li><a class="attrMgr" href="materialTypeMgr.html">材料类型</a></li>
            </ul>
        </li>
    </ul>
</div>
<div class="container attrContainer">
        <!--<div class="sidebar">-->
        <!--<ul id="treeUser" class="ztree"></ul>-->
        <!--</div>-->
        <div class="mainContent">
            <div id="tableToolBar">
                <span class="addUser addAttr"><b></b>增加</span>
                <span class="editUser editAttr"><b></b>修改</span>
                <span class="delUser delAttr"><b></b>删除</span>
                <!--<span class="seeUser seeAttr"><b></b>查看</span>-->
                <!--<button class="btn btn-default addUser">增加</button>-->
                <!--<button class="btn btn-default editUser">修改</button>-->
                <!--<button class="btn btn-default delUser">删除</button>-->
                <!--<button class="btn btn-default seeUser">查看</button>-->
            </div>
            <!--<table id="ysh-unitTable"></table>-->
            <div class="table-container">
                <table id="attrTable" class="table table-striped planTable">
                    <thead>
                    <tr>
                        <th style="width: 10%">序号</th>
                        <th style="width:10% ">属性名</th>
                        <th style="width: 10%">描述</th>
                        <th style="width: 20%">标志</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td colspan="4">暂无数据，请稍后...</td>
                    </tr>

                    </tbody>
                </table>
            </div>
        </div>
</div>
<!--属性模态框-->
<div id="attrModal" class="modal fade" tabindex="-1" role="dialog"  aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="attrModalTitle"></h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal">
                    <div class="form-group">
                        <label for="attrName" data-mId="" class="col-sm-3 control-label">属性名</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="attrName">
                            <!--<input type="text" class="form-control" id="MName" :duplex="@eqM_Info.MNAME">-->
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="attrContent" data-mId="" class="col-sm-3 control-label">描述</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="attrContent">
                            <!--<input type="text" class="form-control" id="MName" :duplex="@eqM_Info.MNAME">-->
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="flag" data-mId="" class="col-sm-3 control-label">标志</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="flag">
                            <!--<input type="text" class="form-control" id="MName" :duplex="@eqM_Info.MNAME">-->
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="subAddAttr">确定</button>
                <button type="button" class="btn btn-primary" id="subEditAttr">确定</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
            <!--</div>-->
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<script src="../../js/jquery-2.1.4.min.js"></script>
<script src="../../bootstrap/js/bootstrap.min.js"></script>
<scripT src="../../plugins/daterangepicker/moment.js"></scripT>
<script src="../../plugins/daterangepicker/daterangepicker.js"></script>
<script src="../../plugins/toastr/toastr.min.js"></script>
<script src="../../plugins/jquery/alert/js/xcConfirm.js"></script>
<script src="../../js/global.js"></script>
<script>
    (function ($) {
        var date = new Date(), baseURL=window.global.SMXprogramURL,uName,protocols,eqType={},eqId="";
        protocols={
            addAttr:baseURL+'property/SHQPDictionaryAdd',
            editAttr:baseURL+'property/SHQPDictionaryEdit',
            delAttr:baseURL+'property/SHQPDictionaryDel',
            getAttr:baseURL+'property/SHQPDictionaryGet',
        };
        var mainHeight = (window.innerHeight - 140)+'px';
        $('.container,.mainContent').innerHeight(mainHeight);
        $(window).resize(function(){
            mainHeight = (window.innerHeight - 140)+'px';
            $('.container,.mainContent').innerHeight(mainHeight);
        });
        uName  = sessionStorage.getItem('PNAME');
        if(uName){
            $('#btnLogin').css('display','none');
            $('#loginOk').removeClass('ysh-disappear');
            $('#loginOk .xiUser').text(uName);
        }
        //绑定事件
        //绑定事件
        document.onclick = function(){
            $('.jdCont,.wsCont,.sysCont,.zlCont,.aqCont').addClass('ysh-disappear');
        }
        $('.ysh-menuList a').on('click',showList);
        $('.wsCont a').on('click',hideList);
        $('.addAttr').on('click',addAttrBtn);
        $('.editAttr').on('click',editAttrBtn);
        $('.delAttr').on('click',delAttrBtn);
        $('#subAddAttr').on('click',subAddAttrBtn);
        $('#subEditAttr').on('click',subEditAttrBtn);
        //表格数据渲染
        $.ajax({
            url:protocols.getAttr,
            type:'post',
            data:{
                FLAG:""
            },
            cache:'false',
            success:function (data) {
                if(!data.code){
                    if(data.rows.length){
                        $('#attrTable>tbody').empty();
                        $.each(data.rows,function (i,o) {
                            var t = '<tr><td>'+(i+1)+'</td><td class="pName">'+o.PName+'</td><td class="pComment">'+o.PComment+'</td>' +
                                    '<td class="dFlag">'+o.DFlag+'</td></tr>';
                            $('#attrTable>tbody').append(t);
                        });
                        //table选中
                        $('#attrTable>tbody td').unbind().on('click',function () {
                            $(this).parent().addClass('table-selected');
                            $(this).parent().siblings().removeClass('table-selected');
                        });
                    }else{
                        $('#attrTable>tbody>tr>td').text('暂无数据')
                    }

                }else{
                    alert(data.msg)
                }
            },
            error:function (data) {
                alert(data.msg)
            }
        });
        //功能函数
        //二级列表显示
        function showList(e) {
            window.event? window.event.cancelBubble = true : e.stopPropagation();
            if($(this).parent().has('ul')){
                $('.jdCont,.wsCont,.sysCont,.zlCont,.aqCont').addClass('ysh-disappear');
                $(this).siblings('ul').removeClass('ysh-disappear');
            }
        }
        function hideList(e) {
            window.event? window.event.cancelBubble = true : e.stopPropagation();
            $(this).parent().parent().addClass('ysh-disappear');

        }
        function addAttrBtn() {
            $('#attrModalTitle').text('添加属性');
            $('#attrModal input').val('');
            $('#subAddAttr').css('display','inline-block');
            $('#subEditAttr').css('display','none');
            $('#attrModal').modal('show');
        }
        function editAttrBtn() {
            var pName = $('#attrTable>tbody>tr.table-selected>td.pName').text();
            var pComment = $('#attrTable>tbody>tr.table-selected>td.pComment').text();
            var dFlag = $('#attrTable>tbody>tr.table-selected>td.dFlag').text();
            if(pName){
                $('#attrModalTitle').text('修改属性');
                $('#subAddAttr').css('display','none');
                $('#subEditAttr').css('display','inline-block');
                $('#attrName').val(pName);
                $('#attrContent').val(pComment);
                $('#flag').val(dFlag);
                $('#attrModal').modal('show');
            }else{
//                alert('请选择属性');
                window.wxc.xcConfirm('请选择属性', window.wxc.xcConfirm.typeEnum.confirm);
            }
        }
        function delAttrBtn() {
            var pName = $('#attrTable>tbody>tr.table-selected>td.pName').text();
            if(pName){
                window.wxc.xcConfirm('确认删除该项目？', window.wxc.xcConfirm.typeEnum.confirm,{
                    onOk:function () {
                        $.ajax({
                            url: protocols.delAttr,
                            type: 'post',
                            data: {
                                PNAME: pName
                            },
                            success: function (data) {
                                if (!data.code) {
                                    $.ajax({
                                        url: protocols.getAttr,
                                        type: 'post',
                                        data: {
                                            FLAG: ""
                                        },
                                        cache: 'false',
                                        success: function (data) {
                                            if (!data.code) {
                                                toastr.success(data.msg);
                                                if (data.rows.length) {
                                                    $('#attrTable>tbody').empty();
                                                    $.each(data.rows, function (i, o) {
                                                        var t = '<tr><td>' + (i + 1) + '</td><td class="pName">' + o.PName + '</td><td class="pComment">' + o.PComment + '</td>' +
                                                            '<td class="dFlag">' + o.DFlag + '</td></tr>';
                                                        $('#attrTable>tbody').append(t);
                                                    });
                                                    //table选中
                                                    $('#attrTable>tbody td').unbind().on('click', function () {
                                                        $(this).parent().addClass('table-selected');
                                                        $(this).parent().siblings().removeClass('table-selected');
                                                    });
                                                } else {
                                                    $('#attrTable>tbody>tr>td').text('暂无数据')
                                                }

                                            } else {
                                                alert(data.msg)
                                            }
                                        },
                                        error: function (data) {
                                            alert(data.msg)
                                        }
                                    });
                                }
                            },
                            error: function (data) {
                                alert(data.msg)
                            }
                        });
                    }
                });
//                if(confirm("确认删除?")) {
//                    $.ajax({
//                        url: protocols.delAttr,
//                        type: 'post',
//                        data: {
//                            PNAME: pName
//                        },
//                        success: function (data) {
//                            if (!data.code) {
//                                $.ajax({
//                                    url: protocols.getAttr,
//                                    type: 'post',
//                                    data: {
//                                        FLAG: ""
//                                    },
//                                    cache: 'false',
//                                    success: function (data) {
//                                        if (!data.code) {
//                                            toastr.success(data.msg);
//                                            if (data.rows.length) {
//                                                $('#attrTable>tbody').empty();
//                                                $.each(data.rows, function (i, o) {
//                                                    var t = '<tr><td>' + (i + 1) + '</td><td class="pName">' + o.PName + '</td><td class="pComment">' + o.PComment + '</td>' +
//                                                            '<td class="dFlag">' + o.DFlag + '</td></tr>';
//                                                    $('#attrTable>tbody').append(t);
//                                                });
//                                                //table选中
//                                                $('#attrTable>tbody td').unbind().on('click', function () {
//                                                    $(this).parent().addClass('table-selected');
//                                                    $(this).parent().siblings().removeClass('table-selected');
//                                                });
//                                            } else {
//                                                $('#attrTable>tbody>tr>td').text('暂无数据')
//                                            }
//
//                                        } else {
//                                            alert(data.msg)
//                                        }
//                                    },
//                                    error: function (data) {
//                                        alert(data.msg)
//                                    }
//                                });
//                            }
//                        },
//                        error: function (data) {
//                            alert(data.msg)
//                        }
//                    });
//                }
            }else{
                alert('请选择属性')
            }

        }
        function subAddAttrBtn() {
           $.ajax({
               url:protocols.addAttr,
               type:'post',
               data:{
                   PNAME:$('#attrName').val(),
                   COMMENT:$('#attrContent').val(),
                   FLAG:$('#flag').val(),
               },
               success:function (data) {
                   if(!data.code) {
                       $.ajax({
                           url:protocols.getAttr,
                           type:'post',
                           data:{
                               FLAG:''
                           },
                           cache:'false',
                           success:function (data) {
                               if(!data.code){
                                   toastr.success(data.msg);
                                   if(data.rows.length){
                                       $('#attrTable>tbody').empty();
                                       $.each(data.rows,function (i,o) {
                                           var t =  '<tr><td>'+(i+1)+'</td><td class="pName">'+o.PName+'</td><td class="pComment">'+o.PComment+'</td>' +
                                                   '<td class="dFlag">'+o.DFlag+'</td></tr>';
                                           $('#attrTable>tbody').append(t);
                                       });
                                       //table选中
                                       $('#attrTable>tbody td').unbind().on('click',function () {
                                           $(this).parent().addClass('table-selected');
                                           $(this).parent().siblings().removeClass('table-selected');
                                       });
                                   }else{
                                       $('#attrTable>tbody>tr>td').text('暂无数据')
                                   }
                                   $('#attrModal').modal('hide');
                               }else{
                                   alert(data.msg)
                               }
                           },
                           error:function (data) {
                               alert(data.msg)
                           }
                       });
                   }else{
                       alert(data.msg)
                   }
               },
               error:function (data) {
                   alert(data.msg)
               }
           });
        }
        function subEditAttrBtn() {
            $.ajax({
                url:protocols.editAttr,
                type:'post',
                data:{
                    PNAME:$('#attrName').val(),
                    COMMENT:$('#attrContent').val(),
                    FLAG:$('#flag').val(),
                },
                success:function (data) {
                    if(!data.code) {
                        $.ajax({
                            url:protocols.getAttr,
                            type:'post',
                            data:{
                                FLAG:''
                            },
                            cache:'false',
                            success:function (data) {
                                if(!data.code){
                                    toastr.success(data.msg);
                                    if(data.rows.length){
                                        $('#attrTable>tbody').empty();
                                        $.each(data.rows,function (i,o) {
                                            var t = '<tr><td>'+(i+1)+'</td><td class="pName">'+o.PName+'</td><td class="pComment">'+o.PComment+'</td>' +
                                                    '<td class="dFlag">'+o.DFlag+'</td></tr>';
                                            $('#attrTable>tbody').append(t);
                                        });
                                        //table选中
                                        $('#attrTable>tbody td').unbind().on('click',function () {
                                            $(this).parent().addClass('table-selected');
                                            $(this).parent().siblings().removeClass('table-selected');
                                        });
                                    }else{
                                        $('#attrTable>tbody>tr>td').text('暂无数据')
                                    }
                                    $('#attrModal').modal('hide');
                                }else{
                                    alert(data.msg)
                                }
                            },
                            error:function (data) {
                                alert(data.msg)
                            }
                        });
                    }else{
                        alert(data.msg)
                    }
                },
                error:function (data) {
                    alert(data.msg)
                }
            })
        }
    })(window.jQuery)
</script>
</body>
</html>