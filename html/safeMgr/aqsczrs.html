<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>三门峡黄河公铁两用桥信息系统</title>
    <link rel="stylesheet" href="../../bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../plugins/daterangepicker/daterangepicker.css">
    <link rel="stylesheet" href='../../plugins/zTree/css/blueStyle/blueStyle.css'>
    <link rel="stylesheet" href="../../plugins/jquery/alert/css/xcConfirm.css">
    <link rel="stylesheet" href="../../css/base.css">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/userMgr.css">
    <style>
        .table-container {
            height: calc(100% - 130px);
        }
        .peopleContainer{
            height: calc(100% - 80px);
        }
        #peopleTable thead th,#peopleTable tbody td{
            text-align: center;
        }
        .ysh-caption>span{
            display: block;
            text-align: center;
            font-size: 25px;
            font-weight: bold;
        }
        .leftData,.rightData{
            margin-right: 5px;
            padding: 8px 10px;
            border:1px solid #c4c4c4;
            height:400px;
        }
        .leftData{
            float: left;
            width:63%;
        }
        .rightData{
            float: left;
            margin-right: 0;
            width: calc(37% - 10px);
        }
        .fieList>li{
            /*float: left;*/
            margin: 10px 15px 10px;
            width:250px;
            height: 110px;
            border:1px solid #999;
        }
        .fieList>li>a{
            display: block;
            padding-top: 5px;
            margin: auto;
            width: 40px;height: 50px;
            /*border: 1px dotted #555555;*/
            text-align: center;
        }
        .fieList>li>p{
            margin-top: 5px;
            text-align: center;
        }
        .fieList>li>a>span{
            font-size: 38px;
            color: #FBDC7C;
        }
        .li-selected{
            background-color: #059C7E;
        }
        .ysh-caption>div{text-align:right;}
        .chj-detail>span{display:block;text-align:left;}
        .chj-badges{text-align:right;margin-top:20px;}
        .chj-badges>span{margin-left:10px;}
        .chj-green{color:green;}
        .chj-red{color:red;}
        .chj-blue{color:#3299CC;}
        .chj-fixed-bottom{position:fixed;bottom:0;left:0;right:0;z-index:1000;height:30px;background-color: #3299CC;text-align:center;line-height: 30px;color:#fff;}
    </style>
</head>
<body>
<header class="ysh-smxHead">
    <div class="ysh-smxTitle">
        <img class="smxLogo" src="../../images/home/logo.png" alt="">
        <h5>三门峡黄河公铁两用桥信息系统</h5>
    </div>
    <ul id="loginOk" class="ysh-XTList">
        <li><a href="javascript:;">退出系统</a></li>
        <li><a href="javascript:;">消息<span class="xtInfo"></span></a></li>
        <li><span class="xiUser"></span>，欢迎使用本系统！</li>
    </ul>
</header>

<div class="ysh-menu">
    <ul class="ysh-menuList">
        <li><a href="../main.html">首页</a></li>
        <li><a  href="../itemGK/itemIntro.html">工程概况</a></li>
        <li><a  href="../userMgr.html">人员管理</a></li>
        <li class="wsMgr">
            <a href="javascript:;">物设管理</a>
            <ul class="wsCont ysh-disappear">
                <li><a href="../wsMgr/equipment.html">机械设备</a></li>
                <li><a href="../wsMgr/materialMgr.html">材料设备</a></li>
            </ul>
        </li>
        <li>
            <a  href="javascript:;">进度管理</a>
            <ul class="jdCont ysh-disappear">
                <li><a href="../processMgr/itemUnit.html">项目单位</a></li>
                <li><a href="../processMgr/sgPlan.html">总施工进度</a></li>
            </ul>
        </li>
        <li>
            <a style=" background: rgb(0,133,106);"  href="safeUserMgr.html">安全管理</a>
            <!--<ul class="aqCont ysh-disappear">-->
            <!--<li><a class="safeUserMgr" href="safeUserMgr.html">安全管理人员</a></li>-->
            <!--<li><a class="tzUserMgr" href="tzUserMgr.html">特种作业人员</a></li>-->
            <!--<li><a href="cyryMgr.html" class="cyUserMgr">从业人员保险</a></li>-->
            <!--<li><a href="aqjgMgr.html" class="safeJGMgr">安全组织机构</a></li>-->
            <!--<li><a href="jxsbMgr.html" class="jxsbMgr">机械设备管理</a></li>-->
            <!--<li><a href="gzzdMgr.html" class="gzzdMgr">规章制度</a></li>-->
            <!--</ul>-->
        </li>
        <li>
            <a href="javascript:;">质量管理</a>
            <ul class="zlCont ysh-disappear">
                <li><a class="reportMgr" href="../zlMgr/reportMgr.html">检测报告</a></li>
            </ul>
        </li>
        <li><a href="javascript:;">风险管理</a></li>
        <li><a href="../jsMgr/datumMgr.html">技术管理</a></li>
        <li><a href="javascript:;">试验管理</a></li>
        <li><a href="javascript:;">视频监控</a></li>
        <li class="sysMgr">
            <a href="javascript:;">系统管理</a>
            <ul class="sysCont ysh-disappear">
                <li><a class="attrMgr" href="../sysMgr/attrMgr.html">属性管理</a></li>
                <li><a class="attrMgr" href="../sysMgr/materialTypeMgr.html">材料类型</a></li>
            </ul>
        </li>
    </ul>
</div>
<div class="container parentContainer">
    <span  class="glyphicon glyphicon-step-backward openState" aria-hidden="true"></span>
    <span class="glyphicon glyphicon-step-forward closeState ysh-disappear" aria-hidden="true"></span>
    <div class="sidebar item-sidebar">
        <ul class="itemList">
            <li><a class="" href="safeUserMgr.html">安全管理人员</a></li>
            <li><a class="" href="tzUserMgr.html">特种作业人员</a></li>
            <li><a class="" href="ryda.html">人员档案</a></li>
            <li><a class="ysh-liActive" href="aqsczrs.html">安全生产责任书</a></li>
            <li><a href="aqsclh.html">安全生产例会</a></li>
            <li><a href="jypx.html">教育培训</a></li>
            <li><a href="aqscfy.html">安全生产费用</a></li>
            <li><a href="xfss.html">消防设施</a></li>
            <li><a href="aqjsjd.html">安全技术交底</a></li>
            <li><a href="lsydjc.html">临时用电检查</a></li>
            <li class="safeWord">
                <a class="safeWordMgr" href="javascript:;">安全生产文档</a>
                <ul class="applyList ysh-disappear">
                    <li><a class="" href="aqscjfsy.html">安全生产经费使用计划</a></li>
                    <li><a class="" href="gysb.html">关于上报我部安全组织机构报告</a></li>
                    <li><a class="" href="xmfz.html">项目负责人待办生产制度</a></li>
                    <li><a class="" href="aqsg.html">安全事故隐患排查治理办法</a></li>
                    <li><a class="" href="aqscjf.html">安全生产奖罚考核制度</a></li>
                    <li><a class="" href="aqfxfz.html">安全风险组管控指导意见</a></li>
                    <li><a class="" href="zdwx.html">重大危险源管理方案</a></li>
                    <li><a class="" href="xmwxy.html">项目危险源</a></li>
                </ul>
            </li>
        </ul>
    </div>
    <div class="container ">
        <div class="sidebar treeSideBar">
            <!--<div class="treeToolBar">-->
            <!--<span class="addTree"></span>-->
            <!--<span class="editTree"></span>-->
            <!--<span class="delTree"></span>-->
            <!--<span class="seeTree"></span>-->
            <!--</div>-->
            <div class="treeContain">
                <ul id="treeUser" class="ztree"></ul>
            </div>
        </div>
        <div class="mainContent">
            <div id="tableToolBar" class="tableTitle"></div>
            <!--<table id="ysh-unitTable"></table>-->
            <div class="table-container">
                <table class="table table-striped safeZrsTable">
                    <thead>
                    <tr>
                        <th style="">序号</th>
                        <th style="">单位</th>
                        <th style="">姓名</th>
                        <th style="">责任书名</th>
                        <th style="">签订日期</th>
                        <th style="">备注</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td colspan="9">请选择部门</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="tableToolBar">
                <span class="addUser addZrs" style=""><b></b>增加</span>
                <span class="editUser editZrs" style=""><b></b>修改</span>
                <span class="delUser delZrs" style=""><b></b>删除</span>
                <!--<span class="seeUser" style=""><b></b>查看详情</span>-->
                <!--<button class="btn btn-default addUser">增加</button>-->
                <!--<button class="btn btn-default editUser">修改</button>-->
                <!--<button class="btn btn-default delUser">删除</button>-->
                <!--<button class="btn btn-default seeUser">查看</button>-->
            </div>
        </div>
    </div>
</div>
<!--责任书增加修改模态框-->
<div class="modal fade" id="safeZrsModal" data-sdid="" tabindex="-1" role="dialog"  aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog" role="document"  >
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="safeZrsModalLabel"></h4>
            </div>
            <div class="modal-body" style="height: 400px;overflow-x: hidden;overflow-y: auto">
                <form class="form-horizontal userForm" data-pid="">
                    <div class="form-group">
                        <label for="sdName" class="col-sm-3 control-label">责任书书名</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="sdName">
                            <!--<input type="text" class="form-control" id="materialInDate" :duplex="@material_Info.NO">-->
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="unit" class="col-sm-3 control-label">部门</label>
                        <div class="col-sm-9">
                            <select name="" id="unit" class="form-control">
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="people" class="col-sm-3 control-label">人员</label>
                        <div class="col-sm-9">
                            <select name="" id="people" class="form-control">
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="signTime" class="col-sm-3 control-label">开始日期</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="signTime" >
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="sdRmk" class="col-sm-3 control-label">备注</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="sdRmk" >
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="subAddZrs">确定</button>
                <button type="button" class="btn btn-primary" id="subEditZrs">确定</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
<script src="../../js/jquery-2.1.4.min.js"></script>
<script src="../../bootstrap/js/bootstrap.min.js"></script>
<script src="../../plugins/zTree/js/jquery.ztree.all.min.js"></script>
<script src="../../plugins/daterangepicker/moment.js"></script>
<script src="../../plugins/daterangepicker/daterangepicker.js"></script>
<script src="../../plugins/toastr/toastr.min.js"></script>
<script src="../../plugins/jquery/alert/js/xcConfirm.js"></script>
<script src="../../js/global.js"></script>
<script>
    (function ($) {
        //全局变量
        var baseURL=window.global.SMXprogramURL,last,protocols, zNodes=[],dpId='',tableSelector='#ysh-unitTable',uName,ztree,
                dpNo,nodeLength,pId,ownerId,
                date = new Date(),last,vm,protocols,clUseMID='',clInMID='',
                today = date.getFullYear()+'-'+(date.getMonth()+1)+'-'+date.getDate(),
                startTime = today,
                endTime = today, last = (date.getFullYear()-20)+'-'+(date.getMonth()+1)+'-'+date.getDate();
        protocols={
            getDepart:baseURL +'safemodel/SHQDepartmentGet',
            getUser:baseURL +'safemodel/SHQPersonGet',
//            addDepart:baseURL +'safemodel/SHQDepartmentAdd',
//            editDepart:baseURL +'safemodel/SHQDepartmentEdit',
//            delDepart:baseURL +'safemodel/SHQDepartmentDel',
            getCertType:baseURL+'safemodel/SHQCertTypeGet',
            uploadFile:baseURL+'upload/uploadfile',
            getFiles:baseURL+'upload/getfile',
            delFiles:baseURL+'upload/SHQAttachDel',
            getSafeZRS:baseURL+'',
            addSafeZRS:baseURL+'',
            delSafeZRS:baseURL+'',
            editSafeZRS:baseURL+'',
        };
        var mainHeight = (window.innerHeight - 160)+'px';
        $('.container,.mainContent').innerHeight(mainHeight);
        $(window).resize(function(){
            mainHeight = (window.innerHeight - 160)+'px';
            $('.container,.mainContent').innerHeight(mainHeight);
        });
        uName  = sessionStorage.getItem('PNAME');
        if(uName){
            $('#loginOk .xiUser').text(uName);
        }else{
            $('#loginModal').modal('show')
        }
        //初始化时间
        $('#signTime').daterangepicker({
            locale: {
                format : 'YYYY-MM-DD',
                separator: ' ~ ',
                weekLabel: '星期',
            },
            startDate:startTime,
            singleDatePicker:true,
            timePicker:true,
            timePicker24Hour:true
        });
        //初始化zTree
        var setting = {
            data: {
                check:{
                    enable:true
                },
                key:{
                    name:'DPName'
                },
                simpleData: {
                    enable: true,
                    idKey:'DPNo',
                    pIdKey:'pId',

                },
                view:{
                    showLine:true,
                    showIcon:true
                }
            },
            callback: {
                beforeMouseDown:beforeMouseDown,
                onMouseDown: onMouseDown,
            }
        };
        //加载树数据
        $.ajax({
            url:protocols.getDepart,
            type:'get',
            cache:false,
            data:{

            },
            success:function (data) {
                if(!data.code){
                    zNodes = treeDataReconstruct(data.rows);
                    //console.log(d);
                }
                //渲染zTree
                ztree =  $.fn.zTree.init($("#treeUser"), setting, zNodes);
            },
            error:function (data) {
                alert(data.msg)
            }
        });

        //鼠标点击之前
        function beforeMouseDown(treeId, treeNode) {
            if(!treeNode){
                return false;
            }else{
                return true;
            }
        }
        //鼠标点击
        function onMouseDown(event,treeId,treeNode) {
            console.log(treeNode);
            dpId = treeNode.DPID;
            dpNo = treeNode.DPNo;
            var data  = getChildNodes(treeNode);
            var doc = $('.tableTitle');
            var s =treeNode.DPName;
            var safeRY=[];
            checkAllParents(treeNode,s,doc);
            nodeLength = data.length;
            console.log(data.length);
//            $.ajax({
//                url:protocols.getSafeZRS,
//                type:'',
//                data:{},
//                success:function (data) {
//                    if(!data.code){
//                        $.each(data.rows,function (i,o) {
//                            if(0){
//                                var t  = '<tr data-sdid="'+o.SDID+'" data-dpid="'+o.DPID+'" data-pid="'+o.PID+'"><td>'+(i+1)+'</td><td class="dpName">'+o.DPID+'</td>' +
//                                        '<td  class="pName">'+o.PID+'</td><td class="sdName">'+o.sdName+'</td><td class="signTime">'+o.SignTime+'</td><td class="rmk">'+o.Remark+'</td>' +
//                                        '<td><button data-sdid="'+o.SDID+'" class="btn btn-default seeZrs">查看</button></td></tr>'
//                                $('.safeZrsTable').append(t);
//                                $('.safeZrsTable tbody td').unbind().on('click',function () {
//                                    $(this).parent().addClass('table-selected');
//                                    $(this).parent().siblings().removeClass('table-selected');
//                                });
//                                $('.seeZrs').unbind().on('click',seeZrs);
//                            }
//                        });
//
//                    }else{
//                        toastr.success(data.msg)
//                    }
//                }
//            });
        }
        //绑定事件
        $('.ysh-menuList a').on('click',showList);
        $('.wsCont a').on('click',hideList);
        document.onclick = function(){
            $('.jdCont,.wsCont,.sysCont,.zlCont,.aqCont').addClass('ysh-disappear');
        }
        $('.openState').on('click',openMenu);
        $('.closeState').on('click',closeMenu);
        $('.safeWordMgr').on('click',toggleOn);

        $('.addZrs').on('click',addZrsBtn);
        $('.editZrs').on('click',editZrsBtn);
        $('.delZrs').on('click',delZrsBtn);
        $('#subAddZrs').on('click',subAddZrsBtn);
        $('#subEditZrs').on('click',subEditZrsBtn);
        //功能函数
        function seeZrs() {//查看责任书

        }
        function addZrsBtn() {
            $('#safeZrsModal input').val('');
            $('#safeZrsModalLabel').text('增加责任书');
            $('#subAddZrs').css('display','inline-block');
            $('#subEditZrs').css('display','none');
            $('#safeZrsModal').modal('show');
        }
        function editZrsBtn() {
            var sdId  = $('.safeZrsTable tbody>tr.table-selected').attr('data-sdid');
            if(sdId){
//                var dpName  = $('.safeZrsTable tbody>tr.tanle-selected>td.dpName').text();
//                var pName  = $('.safeZrsTable tbody>tr.tanle-selected>td.pName').text();
                var sdName =$('.safeZrsTable tbody>tr.table-selected>td.sdName').text();
                var pId  = $('.safeZrsTable tbody>tr.table-selected').attr('data-pid');
                var dpId = $('.safeZrsTable tbody>tr.table-selected').attr('data-dpid');
                var signTime = $('.safeZrsTable tbody>tr.table-selected>td.signTime').text();
                var rmk = $('.safeZrsTable tbody>tr.table-selected>td.rmk').text();
                $('#sdName').val(sdName);
                $('#unit').val(dpId);
                $('#people').val(pId);
                $('#sdRmk').val(rmk);
                $('#signTime').val(signTime);
                $('#safeZrsModalLabel').text('修改责任书');
                $('#subAddZrs').css('display','none');
                $('#subEditZrs').css('display','inline-block');
                $('#safeZrsModal').modal('show');
            }else{
                window.wxc.xcConfirm('请选择责任书！',window.wxc.xcConfirm.typeEnum.warning)
            }
        }
        function delZrsBtn() {
            var sdId  = $('.safeZrsTable tbody>tr.tanle-selected').attr('data-sdid');
            if(sdId){
                window.wxc.xcConfirm('确认删除该附件', window.wxc.xcConfirm.typeEnum.confirm,{
                    onOk:function () {
                        alert('运行删除责任书协议')
//                        $.ajax({
//                            url:protocols.delSafeZRS,
//                            type:'post',
//                            data:{
//
//                            },
//                            success:function (data) {
//                                if(!data.code){
//                                    toastr.success(data.msg);
//                                    drawTable();//根据选中部门渲染表格
//                                    $('').modal('hide');//关闭模态框
//                                }else{
//                                    window.wxc.xcConfirm(data.msg, window.wxc.xcConfirm.typeEnum.warning);
//                                }
//                            }
//                        })
                    }
                });
            }else{
                window.wxc.xcConfirm('请选择责任书！',window.wxc.xcConfirm.typeEnum.warning)
            }
        }
        function subAddZrsBtn() {

        }
        function subEditZrsBtn() {

        }
        function drawTable() {

        }
        //二级列表显示
        function showList(e) {
            window.event? window.event.cancelBubble = true : e.stopPropagation();
            if($(this).parent().has('ul')){
                $('.jdCont,.wsCont,.sysCont,.zlCont,.aqCont').addClass('ysh-disappear');
                $(this).siblings('ul').removeClass('ysh-disappear');
            }
        }
        function hideList(e) {
            window.event? window.event.cancelBubble = true : e.stopPropagation();
            $(this).parent().parent().addClass('ysh-disappear');

        }
        function openMenu() {
            $('.item-sidebar').css('display','none');
            $('.parentContainer').css('padding-left','5px');
            $('.treeSideBar').css('left','15px')
            $('.closeState').removeClass('ysh-disappear');
            $(this).addClass('ysh-disappear')
        }
        function closeMenu() {
            $('.item-sidebar').css('display','block');
            $('.parentContainer').css('padding-left','215px');
            $('.treeSideBar').css('left','230px')
            $('.openState').removeClass('ysh-disappear');
            $(this).addClass('ysh-disappear')
        }
        function toggleOn() {
            if($('.applyList').hasClass('ysh-disappear')){
                $('.safeWord').css('height','422px');
                $('.applyList').removeClass('ysh-disappear');
            }else{
                $('.applyList').addClass('ysh-disappear');
                $('.safeWord').css('height','60px');
            }
        }

        //32Id随机值
        function getUnitId() {
            var chars = ['0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];
            var res = "";
            for(var i = 0; i < 32 ; i ++) {
                var id = Math.ceil(Math.random()*35);
                res += chars[id];
            }
            return res;

        }
        //treeDataReconstruct();修改左边树数据结构
        function treeDataReconstruct(data) {
            //alert('1')
            $.each(data,function (i,o) {
                if(o.DPNo.length < 3){
                    o.pId ='0'
                }else{
                    var s  = o.DPNo.slice(0,-3);
                    o.pId = s;
                }
            });
            return data;
        }
        function checkAllParents(treeNode,string,doc){
            if (!treeNode.pId) {
                doc.text(string);
                return string;

            }else{
                treeNode.checked=true;
                string = treeNode.getParentNode().DPName + "-" + string;
                checkAllParents(treeNode.getParentNode(),string,doc);
            }
        }
        function getChildNodes(treeNode) {
            var childNodes = ztree.transformToArray(treeNode);
            var nodes = new Array();
            for(i = 0; i < childNodes.length; i++) {
                nodes[i] = childNodes[i];
            }
            return nodes;
        }
    })(window.jQuery)
</script>
</body>
</html>